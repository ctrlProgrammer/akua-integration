<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="4933px" preserveAspectRatio="none" style="width:1709px;height:4933px;background:#FAFAFA;" version="1.1" viewBox="0 0 1709 4933" width="1709px" zoomAndPan="magnify"><title>Authorization Flow - Manual Capture</title><defs/><g><rect fill="#FAFAFA" height="4933" style="stroke:none;stroke-width:1;" width="1709" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="290.0352" x="705.605" y="27.9951">Authorization Flow - Manual Capture</text><g><title>Test Function</title><rect fill="#FFFFFF" height="3597.4063" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="1762.6328" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3081.0234"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="478.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2326.7734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2385.0391"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2572.9688"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3144.2891"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3202.5547"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3462.8828"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4093.0078"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4250.6719"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="3115.1563"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="585.3203" style="stroke:#181818;stroke-width:1;" width="10" x="1224.2109" y="2297.6406"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="542.1875" style="stroke:#181818;stroke-width:1;" width="10" x="1224.2109" y="4063.875"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="165.3281" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="2631.2344"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="3521.1484"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="180.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="4308.9375"/></g><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1682.2451" x="10" y="483.3203"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="693.9219"/><rect fill="none" height="872.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1682.2451" x="10" y="1353.6484"/><rect fill="none" height="350.5313" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="1868.8438"/><rect fill="none" height="456.4609" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="3536.1484"/><g><title>Test Function</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="76.356" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="118.5938" y2="4852.6563"/></g><g><title>InitializePaymentFlow</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="479.4683" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="483.2339" x2="483.2339" y1="118.5938" y2="4852.6563"/></g><g><title>akua.Client</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="673.0752" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="676.5156" x2="676.5156" y1="118.5938" y2="4852.6563"/></g><g><title>AuthorizationProvider</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="893.4297" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="896.4482" x2="896.4482" y1="118.5938" y2="4852.6563"/></g><g><title>PaymentsProvider</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="1225.2109" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1228.5068" x2="1228.5068" y1="118.5938" y2="4852.6563"/></g><g><title>Akua API</title><rect fill="#000000" fill-opacity="0.00000" height="4734.0625" width="8" x="1630.3774" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1633.5098" x2="1633.5098" y1="118.5938" y2="4852.6563"/></g><g class="participant participant-head" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="115.292">Test Function</text><ellipse cx="80.356" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,58.7969 L80.356,85.7969 M67.356,66.7969 L93.356,66.7969 M80.356,85.7969 L67.356,100.7969 M80.356,85.7969 L93.356,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="4864.6514">Test Function</text><ellipse cx="80.356" cy="4876.4531" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,4884.4531 L80.356,4911.4531 M67.356,4892.4531 L93.356,4892.4531 M80.356,4911.4531 L67.356,4926.4531 M80.356,4911.4531 L93.356,4926.4531" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="400.2339" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="407.2339" y="107.292">InitializePaymentFlow</text></g><g class="participant participant-tail" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="400.2339" y="4851.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="407.2339" y="4871.6514">InitializePaymentFlow</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="630.5156" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="637.5156" y="107.292">akua.Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="630.5156" y="4851.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="637.5156" y="4871.6514">akua.Client</text></g><g class="participant participant-head" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="814.4482" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="821.4482" y="107.292">AuthorizationProvider</text></g><g class="participant participant-tail" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="814.4482" y="4851.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="821.4482" y="4871.6514">AuthorizationProvider</text></g><g class="participant participant-head" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1158.5068" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1165.5068" y="107.292">PaymentsProvider</text></g><g class="participant participant-tail" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1158.5068" y="4851.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1165.5068" y="4871.6514">PaymentsProvider</text></g><g class="participant participant-head" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1596.5098" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1603.5098" y="107.292">Akua API</text></g><g class="participant participant-tail" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1596.5098" y="4851.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1603.5098" y="4871.6514">Akua API</text></g><g><title>Test Function</title><rect fill="#FFFFFF" height="3597.4063" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="1762.6328" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3081.0234"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="478.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2326.7734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2385.0391"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2572.9688"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3144.2891"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3202.5547"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3462.8828"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4093.0078"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4250.6719"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="3115.1563"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="585.3203" style="stroke:#181818;stroke-width:1;" width="10" x="1224.2109" y="2297.6406"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="542.1875" style="stroke:#181818;stroke-width:1;" width="10" x="1224.2109" y="4063.875"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="165.3281" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="2631.2344"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="3521.1484"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="180.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1629.3774" y="4308.9375"/></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1702.2451" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="178.0298" x="762.1077" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.5039" x="768.1077" y="154.6606">Phase 1: Initialization</text><g class="message" data-participant-1="Test" data-participant-2="InitFlow"><polygon fill="#181818" points="466.4683,188.8594,476.4683,192.8594,466.4683,196.8594,470.4683,192.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="472.4683" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.6597" x="87.356" y="187.7935">InitializePaymentFlow(ctx)</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="488.4683" x2="530.4683" y1="237.125" y2="237.125"/><line style="stroke:#181818;stroke-width:2;" x1="530.4683" x2="530.4683" y1="237.125" y2="250.125"/><line style="stroke:#181818;stroke-width:2;" x1="489.4683" x2="530.4683" y1="250.125" y2="250.125"/><polygon fill="#181818" points="499.4683,246.125,489.4683,250.125,499.4683,254.125,495.4683,250.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.1128" x="495.4683" y="216.9263">InitializeEnvVariables()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.5405" x="495.4683" y="232.0591">Load .env file</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="660.0752,275.2578,670.0752,279.2578,660.0752,283.2578,664.0752,279.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="488.4683" x2="666.0752" y1="279.2578" y2="279.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.1338" x="495.4683" y="274.1919">NewClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="384.0547" y2="384.0547"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="384.0547" y2="397.0547"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="397.0547" y2="397.0547"/><polygon fill="#181818" points="693.0752,393.0547,683.0752,397.0547,693.0752,401.0547,689.0752,397.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.3545" x="689.0752" y="303.3247">Load environment variables:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.5269" x="689.0752" y="318.4575">- AKUA_CLIENT_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4131" x="689.0752" y="333.5903">- AKUA_CLIENT_SECRET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.6313" x="689.0752" y="348.7231">- AKUA_AUDIENCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.8149" x="689.0752" y="363.856">- AKUA_ORGANIZATION_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.7734" x="689.0752" y="378.9888">- AKUA_COMMERCE_ID</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="426.1875" y2="426.1875"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="426.1875" y2="439.1875"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="439.1875" y2="439.1875"/><polygon fill="#181818" points="693.0752,435.1875,683.0752,439.1875,693.0752,443.1875,689.0752,439.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.1333" x="689.0752" y="421.1216">Validate all env vars are set</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="499.4683,464.3203,489.4683,468.3203,499.4683,472.3203,495.4683,468.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="493.4683" x2="676.0752" y1="468.3203" y2="468.3203"/><ellipse cx="510.9683" cy="458.8203" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3276" x="517.4683" y="463.2544">Client (or error)</text></g><path d="M15,483.3203 L74.4429,483.3203 L74.4429,490.4531 L64.4429,500.4531 L10,500.4531 L10,488.3203 A5,5 0 0 1 15,483.3203" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1682.2451" x="10" y="483.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="496.3872">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144.4878" x="89.4429" y="495.5308">[Client Creation Failed]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,517.5859,81.356,521.5859,91.356,525.5859,87.356,521.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="521.5859" y2="521.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="516.52">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="550.7188" y2="550.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="550.7188" y2="563.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="563.7188" y2="563.7188"/><polygon fill="#181818" points="91.356,559.7188,81.356,563.7188,91.356,567.7188,87.356,563.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="545.6528">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1692.2451" y1="572.7188" y2="572.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179.5288" x="15" y="582.9292">[Client Created Successfully]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="660.0752,603.6563,670.0752,607.6563,660.0752,611.6563,664.0752,607.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="666.0752" y1="607.6563" y2="607.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="490.4683" y="602.5903">LoadJwtToken()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="636.7891" y2="636.7891"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="636.7891" y2="649.7891"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="649.7891" y2="649.7891"/><polygon fill="#181818" points="693.0752,645.7891,683.0752,649.7891,693.0752,653.7891,689.0752,649.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.6943" x="689.0752" y="631.7231">Prepare OAuth request body</text></g><g class="message" data-participant-1="Client" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1617.3774,674.9219,1627.3774,678.9219,1617.3774,682.9219,1621.3774,678.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="1623.3774" y1="678.9219" y2="678.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.4688" x="689.0752" y="673.856">POST /oauth/token</text></g><path d="M25,693.9219 L84.4429,693.9219 L84.4429,701.0547 L74.4429,711.0547 L20,711.0547 L20,698.9219 A5,5 0 0 1 25,693.9219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="693.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="706.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171.6548" x="99.4429" y="706.1323">[JWT Token Request Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="693.0752,728.1875,683.0752,732.1875,693.0752,736.1875,689.0752,732.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="687.0752" x2="1628.3774" y1="732.1875" y2="732.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="699.0752" y="727.1216">Error Response</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="494.4683,757.3203,484.4683,761.3203,494.4683,765.3203,490.4683,761.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="488.4683" x2="676.0752" y1="761.3203" y2="761.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="500.4683" y="756.2544">Return Error</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,786.4531,81.356,790.4531,91.356,794.4531,87.356,790.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="790.4531" y2="790.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="785.3872">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="819.5859" y2="819.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="819.5859" y2="832.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="832.5859" y2="832.5859"/><polygon fill="#181818" points="91.356,828.5859,81.356,832.5859,91.356,836.5859,87.356,832.5859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="814.52">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1682.2451" y1="841.5859" y2="841.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.4604" x="25" y="851.7964">[JWT Token Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="688.0752,887.6563,678.0752,891.6563,688.0752,895.6563,684.0752,891.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="682.0752" x2="1633.3774" y1="891.6563" y2="891.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="694.0752" y="871.4575">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.3252" x="694.0752" y="886.5903">{access_token, ...}</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="719.0752" y1="920.7891" y2="920.7891"/><line style="stroke:#181818;stroke-width:2;" x1="719.0752" x2="719.0752" y1="920.7891" y2="933.7891"/><line style="stroke:#181818;stroke-width:2;" x1="678.0752" x2="719.0752" y1="933.7891" y2="933.7891"/><polygon fill="#181818" points="688.0752,929.7891,678.0752,933.7891,688.0752,937.7891,684.0752,933.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8994" x="684.0752" y="915.7231">Store access_token</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="494.4683,958.9219,484.4683,962.9219,494.4683,966.9219,490.4683,962.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="488.4683" x2="676.0752" y1="962.9219" y2="962.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.5874" x="500.4683" y="957.856">JWT Token loaded</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="525.4683" y1="999.0547" y2="999.0547"/><line style="stroke:#181818;stroke-width:2;" x1="525.4683" x2="525.4683" y1="999.0547" y2="1012.0547"/><line style="stroke:#181818;stroke-width:2;" x1="484.4683" x2="525.4683" y1="1012.0547" y2="1012.0547"/><polygon fill="#181818" points="494.4683,1008.0547,484.4683,1012.0547,494.4683,1016.0547,490.4683,1012.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.6069" x="490.4683" y="993.9888">NewAuthorizationProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="525.4683" y1="1041.1875" y2="1041.1875"/><line style="stroke:#181818;stroke-width:2;" x1="525.4683" x2="525.4683" y1="1041.1875" y2="1054.1875"/><line style="stroke:#181818;stroke-width:2;" x1="484.4683" x2="525.4683" y1="1054.1875" y2="1054.1875"/><polygon fill="#181818" points="494.4683,1050.1875,484.4683,1054.1875,494.4683,1058.1875,490.4683,1054.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.8062" x="490.4683" y="1036.1216">NewPaymentsProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,1079.3203,81.356,1083.3203,91.356,1087.3203,87.356,1083.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="1083.3203" y2="1083.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336.4893" x="97.356" y="1078.2544">Return (client, authProvider, paymentsProvider, nil)</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1702.2451" x="0" y="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="1118.8867" y2="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="1121.8867" y2="1121.8867"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="250.3931" x="725.926" y="1108.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="231.8672" x="731.926" y="1124.3872">Phase 2: Authorization Request</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="127.356" y1="1233.25" y2="1233.25"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="1233.25" y2="1246.25"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="1246.25" y2="1246.25"/><polygon fill="#181818" points="96.356,1242.25,86.356,1246.25,96.356,1250.25,92.356,1246.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.8462" x="92.356" y="1152.52">Prepare AuthorizeRequest:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.5942" x="92.356" y="1167.6528">- Amount: {Currency: "USD", Value: 100}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.9434" x="92.356" y="1182.7856">- Intent: "authorization"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.1548" x="92.356" y="1197.9185">- MerchantId: client.GetMerchantId()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.3062" x="92.356" y="1213.0513">- Capture.Mode: "MANUAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9434" x="92.356" y="1228.1841">- Instrument: Card details</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,1276.3828,890.4297,1280.3828,880.4297,1284.3828,884.4297,1280.3828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="886.4297" y1="1280.3828" y2="1280.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.2192" x="92.356" y="1275.3169">Authorize(ctx, client, request)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1305.5156,683.0752,1309.5156,693.0752,1313.5156,689.0752,1309.5156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="1309.5156" y2="1309.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="1304.4497">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,1334.6484,890.4297,1338.6484,880.4297,1342.6484,884.4297,1338.6484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="1338.6484" y2="1338.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.9849" x="684.0752" y="1333.5825">true/false</text></g><path d="M15,1353.6484 L74.4429,1353.6484 L74.4429,1360.7813 L64.4429,1370.7813 L10,1370.7813 L10,1358.6484 A5,5 0 0 1 15,1353.6484" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="872.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1682.2451" x="10" y="1353.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="1366.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.043" x="89.4429" y="1365.8589">[JWT Token Invalid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1387.9141,86.356,1391.9141,96.356,1395.9141,92.356,1391.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="1391.9141" y2="1391.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.0288" x="102.356" y="1386.8481">Error: ErrJWTTokenNotSet</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1421.0469" y2="1421.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1421.0469" y2="1434.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1434.0469" y2="1434.0469"/><polygon fill="#181818" points="96.356,1430.0469,86.356,1434.0469,96.356,1438.0469,92.356,1434.0469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1415.981">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1692.2451" y1="1443.0469" y2="1443.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110.4619" x="15" y="1453.2573">[JWT Token Valid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1477.9844" y2="1477.9844"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1477.9844" y2="1490.9844"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1490.9844" y2="1490.9844"/><polygon fill="#181818" points="908.4297,1486.9844,898.4297,1490.9844,908.4297,1494.9844,904.4297,1490.9844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.7134" x="904.4297" y="1472.9185">json.Marshal(requestData)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1516.1172,683.0752,1520.1172,693.0752,1524.1172,689.0752,1520.1172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="896.4297" y1="1520.1172" y2="1520.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="1515.0513">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="885.4297,1545.25,895.4297,1549.25,885.4297,1553.25,889.4297,1549.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="891.4297" y1="1549.25" y2="1549.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="1544.1841">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1593.5156" y2="1593.5156"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1593.5156" y2="1606.5156"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1606.5156" y2="1606.5156"/><polygon fill="#181818" points="908.4297,1602.5156,898.4297,1606.5156,908.4297,1610.5156,904.4297,1606.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="904.4297" y="1573.3169">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.0322" x="904.4297" y="1588.4497">POST {audience}/v1/authorizations</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1650.7813" y2="1650.7813"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1650.7813" y2="1663.7813"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1663.7813" y2="1663.7813"/><polygon fill="#181818" points="908.4297,1659.7813,898.4297,1663.7813,908.4297,1667.7813,904.4297,1663.7813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="904.4297" y="1630.5825">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.4429" x="904.4297" y="1645.7153">(amount.value + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1738.3125" y2="1738.3125"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1738.3125" y2="1751.3125"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1751.3125" y2="1751.3125"/><polygon fill="#181818" points="908.4297,1747.3125,898.4297,1751.3125,908.4297,1755.3125,904.4297,1751.3125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="904.4297" y="1687.8481">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="904.4297" y="1702.981">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="904.4297" y="1718.1138">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="904.4297" y="1733.2466">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1776.4453,683.0752,1780.4453,693.0752,1784.4453,689.0752,1780.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="896.4297" y1="1780.4453" y2="1780.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="1775.3794">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="885.4297,1805.5781,895.4297,1809.5781,885.4297,1813.5781,889.4297,1809.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="891.4297" y1="1809.5781" y2="1809.5781"/><ellipse cx="689.5752" cy="1800.0781" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="1804.5122">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1617.3774,1849.8438,1627.3774,1853.8438,1617.3774,1857.8438,1621.3774,1853.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="1623.3774" y1="1853.8438" y2="1853.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0381" x="904.4297" y="1833.645">POST /v1/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292.3286" x="904.4297" y="1848.7778">{requestBody with capture.mode=MANUAL}</text></g><path d="M25,1868.8438 L84.4429,1868.8438 L84.4429,1875.9766 L74.4429,1885.9766 L20,1885.9766 L20,1873.8438 A5,5 0 0 1 25,1868.8438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="350.5313" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="1868.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="1881.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136.125" x="99.4429" y="1881.0542">[Authorization Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,1903.1094,898.4297,1907.1094,908.4297,1911.1094,904.4297,1907.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1628.3774" y1="1907.1094" y2="1907.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.3901" x="914.4297" y="1902.0435">Error Response (400/500/etc.)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1932.2422,86.356,1936.2422,96.356,1940.2422,92.356,1936.2422" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="1936.2422" y2="1936.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="102.356" y="1931.1763">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1965.375" y2="1965.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1965.375" y2="1978.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1978.375" y2="1978.375"/><polygon fill="#181818" points="96.356,1974.375,86.356,1978.375,96.356,1982.375,92.356,1978.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1960.3091">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1682.2451" y1="1987.375" y2="1987.375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147.6621" x="25" y="1997.5854">[Authorization Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,2048.5781,898.4297,2052.5781,908.4297,2056.5781,904.4297,2052.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1633.3774" y1="2052.5781" y2="2052.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="914.4297" y="2017.2466">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.2227" x="914.4297" y="2032.3794">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367.0024" x="914.4297" y="2047.5122">{payment_id, transaction: {status: "AUTHORIZED", ...}}</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="2081.7109" y2="2081.7109"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="2081.7109" y2="2094.7109"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="2094.7109" y2="2094.7109"/><polygon fill="#181818" points="908.4297,2090.7109,898.4297,2094.7109,908.4297,2098.7109,904.4297,2094.7109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="904.4297" y="2076.645">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,2134.9766,86.356,2138.9766,96.356,2142.9766,92.356,2138.9766" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="2138.9766" y2="2138.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6543" x="102.356" y="2118.7778">Return *Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324.8096" x="102.356" y="2133.9106">{PaymentID, Transaction.Status: "AUTHORIZED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="2198.375" y2="2198.375"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="2198.375" y2="2211.375"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="2211.375" y2="2211.375"/><polygon fill="#181818" points="96.356,2207.375,86.356,2211.375,96.356,2215.375,92.356,2211.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="2163.0435">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.7988" x="92.356" y="2178.1763">- authorization != nil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.2725" x="92.356" y="2193.3091">- authorization.PaymentID != nil</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1702.2451" x="0" y="2253.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="2253.9414" y2="2253.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="2256.9414" y2="2256.9414"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="370.6367" x="665.8042" y="2243.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="352.1108" x="671.8042" y="2259.4419">Phase 3: Verify Payment State (Before Capture)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,2293.6406,1222.2109,2297.6406,1212.2109,2301.6406,1216.2109,2297.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="1218.2109" y1="2297.6406" y2="2297.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="92.356" y="2292.5747">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2322.7734,683.0752,2326.7734,693.0752,2330.7734,689.0752,2326.7734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1223.2109" y1="2326.7734" y2="2326.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="2321.7075">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,2351.9063,1222.2109,2355.9063,1212.2109,2359.9063,1216.2109,2355.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1218.2109" y1="2355.9063" y2="2355.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="2350.8403">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2381.0391,683.0752,2385.0391,693.0752,2389.0391,689.0752,2385.0391" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1223.2109" y1="2385.0391" y2="2385.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="2379.9731">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,2410.1719,1222.2109,2414.1719,1212.2109,2418.1719,1216.2109,2414.1719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1218.2109" y1="2414.1719" y2="2414.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="2409.106">audience URL</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="2458.4375" y2="2458.4375"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="2458.4375" y2="2471.4375"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="2471.4375" y2="2471.4375"/><polygon fill="#181818" points="1245.2109,2467.4375,1235.2109,2471.4375,1245.2109,2475.4375,1241.2109,2471.4375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1241.2109" y="2438.2388">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1241.2109" y="2453.3716">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="2530.8359" y2="2530.8359"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="2530.8359" y2="2543.8359"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="2543.8359" y2="2543.8359"/><polygon fill="#181818" points="1245.2109,2539.8359,1235.2109,2543.8359,1245.2109,2547.8359,1241.2109,2543.8359" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="1241.2109" y="2495.5044">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="1241.2109" y="2510.6372">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="1241.2109" y="2525.77">- Content-Type: application/json</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2568.9688,683.0752,2572.9688,693.0752,2576.9688,689.0752,2572.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1223.2109" y1="2572.9688" y2="2572.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="2567.9028">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,2598.1016,1222.2109,2602.1016,1212.2109,2606.1016,1216.2109,2602.1016" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1218.2109" y1="2602.1016" y2="2602.1016"/><ellipse cx="689.5752" cy="2592.6016" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="2597.0356">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1617.3774,2627.2344,1627.3774,2631.2344,1617.3774,2635.2344,1621.3774,2631.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1623.3774" y1="2631.2344" y2="2631.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1241.2109" y="2626.1685">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1245.2109,2792.5625,1235.2109,2796.5625,1245.2109,2800.5625,1241.2109,2796.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1239.2109" x2="1633.3774" y1="2796.5625" y2="2796.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1251.2109" y="2655.3013">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.0288" x="1251.2109" y="2670.4341">Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1251.2109" y="2685.5669">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1259.4756" y="2700.6997">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.9028" x="1259.4756" y="2715.8325">status: "AUTHORIZED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="1259.4756" y="2730.9653">capture.mode: "MANUAL",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1259.4756" y="2746.0981">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350.5049" x="1267.7402" y="2761.231">{type: "AUTHORIZATION", status: "AUTHORIZED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1259.4756" y="2776.3638">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1251.2109" y="2791.4966">}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="2825.6953" y2="2825.6953"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="2825.6953" y2="2838.6953"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="2838.6953" y2="2838.6953"/><polygon fill="#181818" points="1245.2109,2834.6953,1235.2109,2838.6953,1245.2109,2842.6953,1241.2109,2838.6953" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1241.2109" y="2820.6294">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,2878.9609,86.356,2882.9609,96.356,2886.9609,92.356,2882.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="1228.2109" y1="2882.9609" y2="2882.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="102.356" y="2862.7622">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340.5391" x="102.356" y="2877.895">{Status: "AUTHORIZED", Capture.Mode: "MANUAL"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="2972.625" y2="2972.625"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="2972.625" y2="2985.625"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="2985.625" y2="2985.625"/><polygon fill="#181818" points="96.356,2981.625,86.356,2985.625,96.356,2989.625,92.356,2985.625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="2907.0278">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.8857" x="92.356" y="2922.1606">- payment.Capture.Mode == "MANUAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.6523" x="92.356" y="2937.2935">- payment.Status == "AUTHORIZED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="92.356" y="2952.4263">- payment.Transactions.length == 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.1123" x="92.356" y="2967.5591">- payment.Transactions[0].Type == "AUTHORIZATION"</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1702.2451" x="0" y="3014.1914"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="3014.1914" y2="3014.1914"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="3017.1914" y2="3017.1914"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="266.9033" x="717.6709" y="3003.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="248.3774" x="723.6709" y="3019.6919">Phase 4: Manual Capture Request</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="132.356" y1="3068.0234" y2="3068.0234"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="3068.0234" y2="3081.0234"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="3081.0234" y2="3081.0234"/><polygon fill="#181818" points="101.356,3077.0234,91.356,3081.0234,101.356,3085.0234,97.356,3081.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.6201" x="97.356" y="3047.8247">Prepare CaptureRequest:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.6523" x="97.356" y="3062.9575">{ID: paymentID}</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3111.1563,890.4297,3115.1563,880.4297,3119.1563,884.4297,3115.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="886.4297" y1="3115.1563" y2="3115.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.7261" x="97.356" y="3110.0903">Capture(ctx, client, captureRequest)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3140.2891,683.0752,3144.2891,693.0752,3148.2891,689.0752,3144.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3144.2891" y2="3144.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="3139.2231">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3169.4219,890.4297,3173.4219,880.4297,3177.4219,884.4297,3173.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3173.4219" y2="3173.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="3168.356">true</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3198.5547,683.0752,3202.5547,693.0752,3206.5547,689.0752,3202.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3202.5547" y2="3202.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="3197.4888">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3227.6875,890.4297,3231.6875,880.4297,3235.6875,884.4297,3231.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3231.6875" y2="3231.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="3226.6216">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3275.9531" y2="3275.9531"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3275.9531" y2="3288.9531"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3288.9531" y2="3288.9531"/><polygon fill="#181818" points="913.4297,3284.9531,903.4297,3288.9531,913.4297,3292.9531,909.4297,3288.9531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="909.4297" y="3255.7544">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297.7813" x="909.4297" y="3270.8872">POST {audience}/v1/payments/{id}/captures</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3333.2188" y2="3333.2188"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3333.2188" y2="3346.2188"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3346.2188" y2="3346.2188"/><polygon fill="#181818" points="913.4297,3342.2188,903.4297,3346.2188,913.4297,3350.2188,909.4297,3346.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="909.4297" y="3313.02">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.3965" x="909.4297" y="3328.1528">(paymentID + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3420.75" y2="3420.75"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3420.75" y2="3433.75"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3433.75" y2="3433.75"/><polygon fill="#181818" points="913.4297,3429.75,903.4297,3433.75,913.4297,3437.75,909.4297,3433.75" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="909.4297" y="3370.2856">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="909.4297" y="3385.4185">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="909.4297" y="3400.5513">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="909.4297" y="3415.6841">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3458.8828,683.0752,3462.8828,693.0752,3466.8828,689.0752,3462.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3462.8828" y2="3462.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="3457.8169">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3488.0156,890.4297,3492.0156,880.4297,3496.0156,884.4297,3492.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3492.0156" y2="3492.0156"/><ellipse cx="689.5752" cy="3482.5156" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="3486.9497">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1617.3774,3517.1484,1627.3774,3521.1484,1617.3774,3525.1484,1621.3774,3521.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="1623.3774" y1="3521.1484" y2="3521.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.7871" x="909.4297" y="3516.0825">POST /v1/payments/{id}/captures</text></g><path d="M25,3536.1484 L84.4429,3536.1484 L84.4429,3543.2813 L74.4429,3553.2813 L20,3553.2813 L20,3541.1484 A5,5 0 0 1 25,3536.1484" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="456.4609" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1662.2451" x="20" y="3536.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="3549.2153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="101.041" x="99.4429" y="3548.3589">[Capture Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="913.4297,3570.4141,903.4297,3574.4141,913.4297,3578.4141,909.4297,3574.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="907.4297" x2="1628.3774" y1="3574.4141" y2="3574.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="919.4297" y="3569.3481">Error Response</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,3599.5469,91.356,3603.5469,101.356,3607.5469,97.356,3603.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="896.4297" y1="3603.5469" y2="3603.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="107.356" y="3598.481">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="132.356" y1="3632.6797" y2="3632.6797"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="132.356" x2="132.356" y1="3632.6797" y2="3645.6797"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="91.356" x2="132.356" y1="3645.6797" y2="3645.6797"/><polygon fill="#181818" points="101.356,3641.6797,91.356,3645.6797,101.356,3649.6797,97.356,3645.6797" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="97.356" y="3627.6138">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1682.2451" y1="3654.6797" y2="3654.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112.5781" x="25" y="3664.8901">[Capture Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,3852.0781,898.4297,3856.0781,908.4297,3860.0781,904.4297,3856.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1633.3774" y1="3856.0781" y2="3856.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.0259" x="914.4297" y="3684.5513">200 OK / 201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.1265" x="914.4297" y="3699.6841">Capture Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="914.4297" y="3714.8169">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.6929" x="922.6943" y="3729.9497">payment: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="930.959" y="3745.0825">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.2192" x="930.959" y="3760.2153">transaction: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.1563" x="939.2236" y="3775.3481">type: "CAPTURE",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.0718" x="939.2236" y="3790.481">status: "CAPTURED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12.397" x="939.2236" y="3805.6138">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="930.959" y="3820.7466">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="922.6943" y="3835.8794">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="914.4297" y="3851.0122">}</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="3885.2109" y2="3885.2109"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="3885.2109" y2="3898.2109"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="3898.2109" y2="3898.2109"/><polygon fill="#181818" points="908.4297,3894.2109,898.4297,3898.2109,908.4297,3902.2109,904.4297,3898.2109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="904.4297" y="3880.145">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,3938.4766,91.356,3942.4766,101.356,3946.4766,97.356,3942.4766" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="896.4297" y1="3942.4766" y2="3942.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.5776" x="107.356" y="3922.2778">Return *CaptureResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307.2202" x="107.356" y="3937.4106">{PaymentId, Transaction.Status: "CAPTURED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="3971.6094" y2="3971.6094"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="3971.6094" y2="3984.6094"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="3984.6094" y2="3984.6094"/><polygon fill="#181818" points="101.356,3980.6094,91.356,3984.6094,101.356,3988.6094,97.356,3984.6094" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.5317" x="97.356" y="3966.5435">Log capture response details</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1702.2451" x="0" y="4020.1758"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="4020.1758" y2="4020.1758"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1702.2451" y1="4023.1758" y2="4023.1758"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="399.6011" x="651.322" y="4009.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="381.0752" x="657.322" y="4025.6763">Phase 5: Verify Final Payment State (After Capture)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,4059.875,1222.2109,4063.875,1212.2109,4067.875,1216.2109,4063.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="1218.2109" y1="4063.875" y2="4063.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="97.356" y="4058.8091">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,4089.0078,683.0752,4093.0078,693.0752,4097.0078,689.0752,4093.0078" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1223.2109" y1="4093.0078" y2="4093.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="4087.9419">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,4118.1406,1222.2109,4122.1406,1212.2109,4126.1406,1216.2109,4122.1406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1218.2109" y1="4122.1406" y2="4122.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="4117.0747">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="4166.4063" y2="4166.4063"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="4166.4063" y2="4179.4063"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="4179.4063" y2="4179.4063"/><polygon fill="#181818" points="1245.2109,4175.4063,1235.2109,4179.4063,1245.2109,4183.4063,1241.2109,4179.4063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1241.2109" y="4146.2075">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1241.2109" y="4161.3403">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="4208.5391" y2="4208.5391"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="4208.5391" y2="4221.5391"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="4221.5391" y2="4221.5391"/><polygon fill="#181818" points="1245.2109,4217.5391,1235.2109,4221.5391,1245.2109,4225.5391,1241.2109,4221.5391" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5869" x="1241.2109" y="4203.4731">Set Headers</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,4246.6719,683.0752,4250.6719,693.0752,4254.6719,689.0752,4250.6719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1223.2109" y1="4250.6719" y2="4250.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="4245.606">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1212.2109,4275.8047,1222.2109,4279.8047,1212.2109,4283.8047,1216.2109,4279.8047" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1218.2109" y1="4279.8047" y2="4279.8047"/><ellipse cx="689.5752" cy="4270.3047" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="4274.7388">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1617.3774,4304.9375,1627.3774,4308.9375,1617.3774,4312.9375,1621.3774,4308.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1623.3774" y1="4308.9375" y2="4308.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1241.2109" y="4303.8716">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1245.2109,4485.3984,1235.2109,4489.3984,1245.2109,4493.3984,1241.2109,4489.3984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1239.2109" x2="1633.3774" y1="4489.3984" y2="4489.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1251.2109" y="4333.0044">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.0679" x="1251.2109" y="4348.1372">Final Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1251.2109" y="4363.27">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1259.4756" y="4378.4028">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.0718" x="1259.4756" y="4393.5356">status: "CAPTURED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="1259.4756" y="4408.6685">capture.mode: "MANUAL",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1259.4756" y="4423.8013">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354.6372" x="1267.7402" y="4438.9341">{type: "AUTHORIZATION", status: "AUTHORIZED", ...},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.4316" x="1267.7402" y="4454.0669">{type: "CAPTURE", status: "CAPTURED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1259.4756" y="4469.1997">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1251.2109" y="4484.3325">}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1234.2109" x2="1276.2109" y1="4518.5313" y2="4518.5313"/><line style="stroke:#181818;stroke-width:2;" x1="1276.2109" x2="1276.2109" y1="4518.5313" y2="4531.5313"/><line style="stroke:#181818;stroke-width:2;" x1="1235.2109" x2="1276.2109" y1="4531.5313" y2="4531.5313"/><polygon fill="#181818" points="1245.2109,4527.5313,1235.2109,4531.5313,1245.2109,4535.5313,1241.2109,4531.5313" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1241.2109" y="4513.4653">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,4602.0625,91.356,4606.0625,101.356,4610.0625,97.356,4606.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="1228.2109" y1="4606.0625" y2="4606.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="107.356" y="4555.5981">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.9761" x="107.356" y="4570.731">with both transactions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.146" x="107.356" y="4585.8638">- AUTHORIZATION transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.9038" x="107.356" y="4600.9966">- CAPTURE transaction</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4695.7266" y2="4695.7266"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4695.7266" y2="4708.7266"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4708.7266" y2="4708.7266"/><polygon fill="#181818" points="101.356,4704.7266,91.356,4708.7266,101.356,4712.7266,97.356,4708.7266" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.0796" x="97.356" y="4630.1294">Verify Final State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="97.356" y="4645.2622">- payment.Transactions.length == 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.1123" x="97.356" y="4660.395">- payment.Transactions[0].Type == "AUTHORIZATION"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310.8701" x="97.356" y="4675.5278">- payment.Transactions[1].Type == "CAPTURE"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224.8213" x="97.356" y="4690.6606">- payment.Status == "CAPTURED"</text></g><path d="M95,4726.7266 L95,4831.7266 A5,5 0 0 0 100,4836.7266 L504,4836.7266 A5,5 0 0 0 509,4831.7266 L509,4731.7266 L499,4721.7266 L100,4721.7266 A5,5 0 0 0 95,4726.7266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M499,4721.7266 L499,4729.2266 A2.5,2.5 0 0 0 501.5,4731.7266 L509,4731.7266 L499,4721.7266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="262.1074" x="101" y="4738.7935">Key Differences from Auto Capture:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.7866" x="101" y="4753.9263">1. Capture mode is set to "MANUAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393.3516" x="101" y="4769.0591">2. Payment stays in "AUTHORIZED" state after authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.0332" x="101" y="4784.1919">3. Requires separate Capture() call</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291.5605" x="101" y="4799.3247">4. Payment has 2 transactions after capture:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.146" x="113.397" y="4814.4575">- AUTHORIZATION transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.9038" x="113.397" y="4829.5903">- CAPTURE transaction</text><!--SRC=[vLfRRzis57xNhpZpNkpCaPEqVJ6G0Oxj96vpGsntG9iYO2GwqI9JdaGdTGF_znrIb4JgOYljDXHOYwOsTKWUdiltVLJBFUvJw2tvGn1wtmZt0WR7Vl0Ckt1Es9Buq2SBlWofPKMF7bkGaCmXedyjANDeBmo3vyc3vpmo6aLme9c4mPAvJX0o6iB-dlRWZZYFz_9fF_2347uzxedVbaKSZbyR4nfnE5uoHxZI01A16B5mClSSRq4OXyQ8UTmZllUDNf7Ld38kF9QsueduOjgJnoMn-xw7bj8g_cZQ626u2eCdpwMXj1PFaW5pZjezCippWxbjq1NeNOtYbV4BVhQimqEuUY0HXVqkf8UBat5uQCcGxFwU7awpqGFGTFZNbWYZzqGupK9X9P-grXYofuyazCYTJwDcwuQT1SG5cx8dc7a-DQR7aUl21NsEFpQr7LLOuxzqQxaWhkU50HFUmbEoNVU6xKBlmxHtspyR3IycjwD1VcGyx5yF9-beRph0uVum7RYyFkbTZ3xr9gFB2sFwvVdvyBe_nB4IbpxYoLtXDF5zuPfmAG8IKYpkx0X6m7RKQ1FBb6BbXotBfVd3MyJdwZFqGweQYc0SNGlmLnPCN5iajWlN5FkBmL0iAMsqLTCaYl6u3j9vt3ucdFXDzALbKJ-YnhxKXV7ISR0lPqlVN-KsDtFp_fbFWaVAC9d2B7ycCIP_5CDu5TA52DgbQ1881IwWZtU1kyfDKAMECox74-W41EqxN6ngRfcqHBgdYEVxFoOW7SHOnJje4HM_r2mPdCGr6K-S42q25j7Kj3IrXHJaqg058lT4zxTkVZVbU5kUnNEPwomcAiqRWt6mjv-KnGrx8NB2hGn_6spRNjSvMZ7xOqHix21jjSrXpdpsiUgq_9M7cZ8tguDo44CSAWLkLScLa_8WNR3FPw_fIB_QG3GsQCCYjquRcEUtAhjOd2W3-uDkZdYJwjOmFtOYQRF4d2hB63xdoAPezD9VXY7IygeBZUbuq6WBa5lIBlBltbeOZXYNQMiGVTU6U7HEG-S12MhaTY4-gNr2UJOgQ64taGBsUU3YietptiMqTzQ8buvuk9pBvViaTF7q75iqoiX1idXwB9rJioXGGM5jI4Aju4HZ68EABVsRNfO8PwD80lm6TYeuWVxJpenWRrN1UbQ-8_OabfTvDhr8KoRRNVw5q-IiYu2FAS_NXd6aMYYVkV6nmedyqVwC0cQV8y4zu48ggWDSjLKwDmaZ5a1lwNf2w6qWXifu4ZKNfjTdLdMJrt0_1YuudKokOlfGrN_3vBUNPATrvsc_OzHsL6Fr4ueQLNQfI-UBW8iEslr0LpUiIMHdsK-YZU0tuDuSToNpXJrbtjSBme9cgrLZ1ymwd584l53f7Tt5BXnHREqGNYI0nergUeAj_KXNyaa_a3syEraji0F9Ok5xZboc8t9S7L0jfwUSBrBjzkgixZpWT5kpV4rMJGrGI1OoaohE8nGGyEoXf70KvCmHSWvZm5dNK0ov2qsrMZ1FPse6QBxTs-kymp-KEtOhcr_UyTjuFi-dcq2WjWmm3xf92fWdDGH1deNYusCw5BtTUcuRyP6mY3XnpRvW7_1bX2JGcqvEBwz7duQ2S8IKgAKbAc9P2bnJDa-XA_QiRYfsZ8FXUHJjZmPjc6J7iSSbXrdNpbCkOOaFlIYYOSpGHfd3BuT291J6xTGvPP5g85CrlC7B2mszsIgvQO9m7ulrYCw475CatT9LH5xkI21GWqShf7U3TnU98nfx5cwrLdxaUnYuw9TWuJB-tRIRILIlsiuWgPhR5bVH2UfagF6J-6BIKo8OEqblZTnrpLrUJIDRo69RJ0sYU5LK3PAe6TMK74JCAYDL01HBXxYY9mTxUt3v0OM2QfK4sp20BpSCm4Ezgu6S62f5Dl50fw9C_Sf76ZRYpCzY230JCkxfEl8D1O9aDNIAULzksDegGSwQHLA9cCNf1RHK9XYQSQcBvVBVyBO84vMWgC9kwwiYPXdNYiGczaS-rJpIBJGuZsoVidlK3cY-NsNpUU-BBVh2M3FEa8QrRxkvjw3RhsZACBkWlOm6tGnIr_LkH6eL4vSTO-d_y5fKriFrRWsrjza6nF_W3I435izTTrHG8-kxRmbfRYkl23_BzS2gUosedRPjIB_z2b2HZIB-oHUhgWirGLzNp5klKUuLolM7hks9xxf6twJF1N51nnJg6Ggb4brmXeeX5aBCF2Mi1Zdz7e_XQCnH_TxLP7ezRBIJyPIar9D1zWYPAlue-Mej-6f3pAmVLFbR57uAjsb04XdjLcZyz43hhJcrYgh-BBXFS1WIHzENNQPGVvSAzMEF8ONav7flnl54_n-r_XF8vl-Lv3MBxZN2rspvVr_sjis9AHQLUVHJwMJvXkekm1z692I9wwVN7qkQZe-Z3xz6H1ke8j6aMqCA7to75AwSigzDIV9L8TZJt5aMGz42eNV_m26OnVfN97vd1rKC3BpPZ8f_lw0HpC9WBk0uIF2nkxCZJVVjb4T5FO8NYN-l1JHC2ZC6xGCxhNmiebK47ZCAJvOM1I8ns7WD8wU_iIKOULWMkBxuZmiy9V1c2rl2Zz_ElCssGSY70wCErEggVxh9Qw8DjP6Pb5K8iWk82FuD]--></g></svg>