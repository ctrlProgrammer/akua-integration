<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="5338px" preserveAspectRatio="none" style="width:1727px;height:5338px;background:#FAFAFA;" version="1.1" viewBox="0 0 1727 5338" width="1727px" zoomAndPan="magnify"><title>Authorization Flow - Auto Capture and Refund</title><defs/><g><rect fill="#FAFAFA" height="5338" style="stroke:none;stroke-width:1;" width="1727" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="365.0938" x="677.3579" y="27.9951">Authorization Flow - Auto Capture and Refund</text><g><title>Test Function</title><rect fill="#FFFFFF" height="4002.7266" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="2046.8906" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3202.0859"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="468.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2387.3047"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2445.5703"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2633.5"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3265.3516"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3323.6172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3583.9453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="4244.3359"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="4402"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="882.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="882.4297" y="3236.2188"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="645.8516" style="stroke:#181818;stroke-width:1;" width="10" x="1258.1748" y="2358.1719"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="648.1172" style="stroke:#181818;stroke-width:1;" width="10" x="1258.1748" y="4215.2031"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="225.8594" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="2691.7656"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="3642.2109"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="271.2578" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="4460.2656"/></g><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1700.8096" x="10" y="483.3203"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="693.9219"/><rect fill="none" height="933.2578" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1700.8096" x="10" y="1353.6484"/><rect fill="none" height="411.0625" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="1868.8438"/><rect fill="none" height="486.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="3657.2109"/><g><title>Test Function</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="76.356" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="118.5938" y2="5257.9766"/></g><g><title>InitializePaymentFlow</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="469.4683" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="473.2339" x2="473.2339" y1="118.5938" y2="5257.9766"/></g><g><title>akua.Client</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="663.0752" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="666.5156" x2="666.5156" y1="118.5938" y2="5257.9766"/></g><g><title>AuthorizationProvider</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="883.4297" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="886.4482" x2="886.4482" y1="118.5938" y2="5257.9766"/></g><g><title>PaymentsProvider</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="1259.1748" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1262.4707" x2="1262.4707" y1="118.5938" y2="5257.9766"/></g><g><title>Akua API</title><rect fill="#000000" fill-opacity="0.00000" height="5139.3828" width="8" x="1648.9419" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1652.0742" x2="1652.0742" y1="118.5938" y2="5257.9766"/></g><g class="participant participant-head" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="115.292">Test Function</text><ellipse cx="80.356" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,58.7969 L80.356,85.7969 M67.356,66.7969 L93.356,66.7969 M80.356,85.7969 L67.356,100.7969 M80.356,85.7969 L93.356,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="5269.9717">Test Function</text><ellipse cx="80.356" cy="5281.7734" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,5289.7734 L80.356,5316.7734 M67.356,5297.7734 L93.356,5297.7734 M80.356,5316.7734 L67.356,5331.7734 M80.356,5316.7734 L93.356,5331.7734" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="390.2339" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="397.2339" y="107.292">InitializePaymentFlow</text></g><g class="participant participant-tail" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="390.2339" y="5256.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="397.2339" y="5276.9717">InitializePaymentFlow</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="620.5156" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="627.5156" y="107.292">akua.Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="620.5156" y="5256.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="627.5156" y="5276.9717">akua.Client</text></g><g class="participant participant-head" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="804.4482" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="811.4482" y="107.292">AuthorizationProvider</text></g><g class="participant participant-tail" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="804.4482" y="5256.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="811.4482" y="5276.9717">AuthorizationProvider</text></g><g class="participant participant-head" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1192.4707" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1199.4707" y="107.292">PaymentsProvider</text></g><g class="participant participant-tail" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1192.4707" y="5256.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1199.4707" y="5276.9717">PaymentsProvider</text></g><g class="participant participant-head" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1615.0742" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1622.0742" y="107.292">Akua API</text></g><g class="participant participant-tail" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1615.0742" y="5256.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1622.0742" y="5276.9717">Akua API</text></g><g><title>Test Function</title><rect fill="#FFFFFF" height="4002.7266" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="2046.8906" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3202.0859"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="468.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2387.3047"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2445.5703"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="2633.5"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3265.3516"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3323.6172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="3583.9453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="4244.3359"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="662.0752" y="4402"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="882.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="882.4297" y="3236.2188"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="645.8516" style="stroke:#181818;stroke-width:1;" width="10" x="1258.1748" y="2358.1719"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="648.1172" style="stroke:#181818;stroke-width:1;" width="10" x="1258.1748" y="4215.2031"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="225.8594" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="2691.7656"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="3642.2109"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="271.2578" style="stroke:#181818;stroke-width:1;" width="10" x="1647.9419" y="4460.2656"/></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1720.8096" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="178.0298" x="771.3899" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.5039" x="777.3899" y="154.6606">Phase 1: Initialization</text><g class="message" data-participant-1="Test" data-participant-2="InitFlow"><polygon fill="#181818" points="456.4683,188.8594,466.4683,192.8594,456.4683,196.8594,460.4683,192.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="462.4683" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.6597" x="87.356" y="187.7935">InitializePaymentFlow(ctx)</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="478.4683" x2="520.4683" y1="237.125" y2="237.125"/><line style="stroke:#181818;stroke-width:2;" x1="520.4683" x2="520.4683" y1="237.125" y2="250.125"/><line style="stroke:#181818;stroke-width:2;" x1="479.4683" x2="520.4683" y1="250.125" y2="250.125"/><polygon fill="#181818" points="489.4683,246.125,479.4683,250.125,489.4683,254.125,485.4683,250.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.1128" x="485.4683" y="216.9263">InitializeEnvVariables()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.5405" x="485.4683" y="232.0591">Load .env file</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="650.0752,275.2578,660.0752,279.2578,650.0752,283.2578,654.0752,279.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="478.4683" x2="656.0752" y1="279.2578" y2="279.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.1338" x="485.4683" y="274.1919">NewClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="672.0752" x2="714.0752" y1="384.0547" y2="384.0547"/><line style="stroke:#181818;stroke-width:2;" x1="714.0752" x2="714.0752" y1="384.0547" y2="397.0547"/><line style="stroke:#181818;stroke-width:2;" x1="673.0752" x2="714.0752" y1="397.0547" y2="397.0547"/><polygon fill="#181818" points="683.0752,393.0547,673.0752,397.0547,683.0752,401.0547,679.0752,397.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.3545" x="679.0752" y="303.3247">Load environment variables:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.5269" x="679.0752" y="318.4575">- AKUA_CLIENT_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4131" x="679.0752" y="333.5903">- AKUA_CLIENT_SECRET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.6313" x="679.0752" y="348.7231">- AKUA_AUDIENCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.8149" x="679.0752" y="363.856">- AKUA_ORGANIZATION_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.7734" x="679.0752" y="378.9888">- AKUA_COMMERCE_ID</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="672.0752" x2="714.0752" y1="426.1875" y2="426.1875"/><line style="stroke:#181818;stroke-width:2;" x1="714.0752" x2="714.0752" y1="426.1875" y2="439.1875"/><line style="stroke:#181818;stroke-width:2;" x1="673.0752" x2="714.0752" y1="439.1875" y2="439.1875"/><polygon fill="#181818" points="683.0752,435.1875,673.0752,439.1875,683.0752,443.1875,679.0752,439.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.1333" x="679.0752" y="421.1216">Validate all env vars are set</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="489.4683,464.3203,479.4683,468.3203,489.4683,472.3203,485.4683,468.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="483.4683" x2="666.0752" y1="468.3203" y2="468.3203"/><ellipse cx="500.9683" cy="458.8203" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3276" x="507.4683" y="463.2544">Client (or error)</text></g><path d="M15,483.3203 L74.4429,483.3203 L74.4429,490.4531 L64.4429,500.4531 L10,500.4531 L10,488.3203 A5,5 0 0 1 15,483.3203" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1700.8096" x="10" y="483.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="496.3872">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144.4878" x="89.4429" y="495.5308">[Client Creation Failed]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,517.5859,81.356,521.5859,91.356,525.5859,87.356,521.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="472.4683" y1="521.5859" y2="521.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="516.52">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="550.7188" y2="550.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="550.7188" y2="563.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="563.7188" y2="563.7188"/><polygon fill="#181818" points="91.356,559.7188,81.356,563.7188,91.356,567.7188,87.356,563.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="545.6528">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1710.8096" y1="572.7188" y2="572.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179.5288" x="15" y="582.9292">[Client Created Successfully]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="650.0752,603.6563,660.0752,607.6563,650.0752,611.6563,654.0752,607.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="473.4683" x2="656.0752" y1="607.6563" y2="607.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="480.4683" y="602.5903">LoadJwtToken()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="672.0752" x2="714.0752" y1="636.7891" y2="636.7891"/><line style="stroke:#181818;stroke-width:2;" x1="714.0752" x2="714.0752" y1="636.7891" y2="649.7891"/><line style="stroke:#181818;stroke-width:2;" x1="673.0752" x2="714.0752" y1="649.7891" y2="649.7891"/><polygon fill="#181818" points="683.0752,645.7891,673.0752,649.7891,683.0752,653.7891,679.0752,649.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.6943" x="679.0752" y="631.7231">Prepare OAuth request body</text></g><g class="message" data-participant-1="Client" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1635.9419,674.9219,1645.9419,678.9219,1635.9419,682.9219,1639.9419,678.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="672.0752" x2="1641.9419" y1="678.9219" y2="678.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.4688" x="679.0752" y="673.856">POST /oauth/token</text></g><path d="M25,693.9219 L84.4429,693.9219 L84.4429,701.0547 L74.4429,711.0547 L20,711.0547 L20,698.9219 A5,5 0 0 1 25,693.9219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="693.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="706.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171.6548" x="99.4429" y="706.1323">[JWT Token Request Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="683.0752,728.1875,673.0752,732.1875,683.0752,736.1875,679.0752,732.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1646.9419" y1="732.1875" y2="732.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="689.0752" y="727.1216">Error Response</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="484.4683,757.3203,474.4683,761.3203,484.4683,765.3203,480.4683,761.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="478.4683" x2="666.0752" y1="761.3203" y2="761.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="490.4683" y="756.2544">Return Error</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,786.4531,81.356,790.4531,91.356,794.4531,87.356,790.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="472.4683" y1="790.4531" y2="790.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="785.3872">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="819.5859" y2="819.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="819.5859" y2="832.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="832.5859" y2="832.5859"/><polygon fill="#181818" points="91.356,828.5859,81.356,832.5859,91.356,836.5859,87.356,832.5859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="814.52">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1700.8096" y1="841.5859" y2="841.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.4604" x="25" y="851.7964">[JWT Token Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="678.0752,887.6563,668.0752,891.6563,678.0752,895.6563,674.0752,891.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="672.0752" x2="1651.9419" y1="891.6563" y2="891.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="684.0752" y="871.4575">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.3252" x="684.0752" y="886.5903">{access_token, ...}</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="667.0752" x2="709.0752" y1="920.7891" y2="920.7891"/><line style="stroke:#181818;stroke-width:2;" x1="709.0752" x2="709.0752" y1="920.7891" y2="933.7891"/><line style="stroke:#181818;stroke-width:2;" x1="668.0752" x2="709.0752" y1="933.7891" y2="933.7891"/><polygon fill="#181818" points="678.0752,929.7891,668.0752,933.7891,678.0752,937.7891,674.0752,933.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8994" x="674.0752" y="915.7231">Store access_token</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="484.4683,958.9219,474.4683,962.9219,484.4683,966.9219,480.4683,962.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="478.4683" x2="666.0752" y1="962.9219" y2="962.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.5874" x="490.4683" y="957.856">JWT Token loaded</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="473.4683" x2="515.4683" y1="999.0547" y2="999.0547"/><line style="stroke:#181818;stroke-width:2;" x1="515.4683" x2="515.4683" y1="999.0547" y2="1012.0547"/><line style="stroke:#181818;stroke-width:2;" x1="474.4683" x2="515.4683" y1="1012.0547" y2="1012.0547"/><polygon fill="#181818" points="484.4683,1008.0547,474.4683,1012.0547,484.4683,1016.0547,480.4683,1012.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.6069" x="480.4683" y="993.9888">NewAuthorizationProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="473.4683" x2="515.4683" y1="1041.1875" y2="1041.1875"/><line style="stroke:#181818;stroke-width:2;" x1="515.4683" x2="515.4683" y1="1041.1875" y2="1054.1875"/><line style="stroke:#181818;stroke-width:2;" x1="474.4683" x2="515.4683" y1="1054.1875" y2="1054.1875"/><polygon fill="#181818" points="484.4683,1050.1875,474.4683,1054.1875,484.4683,1058.1875,480.4683,1054.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.8062" x="480.4683" y="1036.1216">NewPaymentsProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,1079.3203,81.356,1083.3203,91.356,1087.3203,87.356,1083.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="472.4683" y1="1083.3203" y2="1083.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336.4893" x="97.356" y="1078.2544">Return (client, authProvider, paymentsProvider, nil)</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1720.8096" x="0" y="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="1118.8867" y2="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="1121.8867" y2="1121.8867"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="364.105" x="678.3523" y="1108.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="345.5791" x="684.3523" y="1124.3872">Phase 2: Authorization Request (Auto Capture)</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="127.356" y1="1233.25" y2="1233.25"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="1233.25" y2="1246.25"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="1246.25" y2="1246.25"/><polygon fill="#181818" points="96.356,1242.25,86.356,1246.25,96.356,1250.25,92.356,1246.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.8462" x="92.356" y="1152.52">Prepare AuthorizeRequest:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.5942" x="92.356" y="1167.6528">- Amount: {Currency: "USD", Value: 100}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.9434" x="92.356" y="1182.7856">- Intent: "authorization"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.1548" x="92.356" y="1197.9185">- MerchantId: client.GetMerchantId()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.3643" x="92.356" y="1213.0513">- Capture.Mode: "AUTOMATIC"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9434" x="92.356" y="1228.1841">- Instrument: Card details</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,1276.3828,880.4297,1280.3828,870.4297,1284.3828,874.4297,1280.3828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="876.4297" y1="1280.3828" y2="1280.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.2192" x="92.356" y="1275.3169">Authorize(ctx, client, request)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,1305.5156,673.0752,1309.5156,683.0752,1313.5156,679.0752,1309.5156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="881.4297" y1="1309.5156" y2="1309.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="689.0752" y="1304.4497">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,1334.6484,880.4297,1338.6484,870.4297,1342.6484,874.4297,1338.6484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="876.4297" y1="1338.6484" y2="1338.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.9849" x="674.0752" y="1333.5825">true/false</text></g><path d="M15,1353.6484 L74.4429,1353.6484 L74.4429,1360.7813 L64.4429,1370.7813 L10,1370.7813 L10,1358.6484 A5,5 0 0 1 15,1353.6484" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="933.2578" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1700.8096" x="10" y="1353.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="1366.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.043" x="89.4429" y="1365.8589">[JWT Token Invalid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1387.9141,86.356,1391.9141,96.356,1395.9141,92.356,1391.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="886.4297" y1="1391.9141" y2="1391.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.0288" x="102.356" y="1386.8481">Error: ErrJWTTokenNotSet</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1421.0469" y2="1421.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1421.0469" y2="1434.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1434.0469" y2="1434.0469"/><polygon fill="#181818" points="96.356,1430.0469,86.356,1434.0469,96.356,1438.0469,92.356,1434.0469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1415.981">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1710.8096" y1="1443.0469" y2="1443.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110.4619" x="15" y="1453.2573">[JWT Token Valid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="1477.9844" y2="1477.9844"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="1477.9844" y2="1490.9844"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="1490.9844" y2="1490.9844"/><polygon fill="#181818" points="898.4297,1486.9844,888.4297,1490.9844,898.4297,1494.9844,894.4297,1490.9844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.7134" x="894.4297" y="1472.9185">json.Marshal(requestData)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,1516.1172,673.0752,1520.1172,683.0752,1524.1172,679.0752,1520.1172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="886.4297" y1="1520.1172" y2="1520.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="689.0752" y="1515.0513">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="875.4297,1545.25,885.4297,1549.25,875.4297,1553.25,879.4297,1549.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="881.4297" y1="1549.25" y2="1549.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="674.0752" y="1544.1841">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="1593.5156" y2="1593.5156"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="1593.5156" y2="1606.5156"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="1606.5156" y2="1606.5156"/><polygon fill="#181818" points="898.4297,1602.5156,888.4297,1606.5156,898.4297,1610.5156,894.4297,1606.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="894.4297" y="1573.3169">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.0322" x="894.4297" y="1588.4497">POST {audience}/v1/authorizations</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="1650.7813" y2="1650.7813"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="1650.7813" y2="1663.7813"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="1663.7813" y2="1663.7813"/><polygon fill="#181818" points="898.4297,1659.7813,888.4297,1663.7813,898.4297,1667.7813,894.4297,1663.7813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="894.4297" y="1630.5825">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.4429" x="894.4297" y="1645.7153">(amount.value + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="1738.3125" y2="1738.3125"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="1738.3125" y2="1751.3125"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="1751.3125" y2="1751.3125"/><polygon fill="#181818" points="898.4297,1747.3125,888.4297,1751.3125,898.4297,1755.3125,894.4297,1751.3125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="894.4297" y="1687.8481">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="894.4297" y="1702.981">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="894.4297" y="1718.1138">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="894.4297" y="1733.2466">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,1776.4453,673.0752,1780.4453,683.0752,1784.4453,679.0752,1780.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="886.4297" y1="1780.4453" y2="1780.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="689.0752" y="1775.3794">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="875.4297,1805.5781,885.4297,1809.5781,875.4297,1813.5781,879.4297,1809.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="881.4297" y1="1809.5781" y2="1809.5781"/><ellipse cx="679.5752" cy="1800.0781" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="686.0752" y="1804.5122">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1635.9419,1849.8438,1645.9419,1853.8438,1635.9419,1857.8438,1639.9419,1853.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="1641.9419" y1="1853.8438" y2="1853.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0381" x="894.4297" y="1833.645">POST /v1/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314.3867" x="894.4297" y="1848.7778">{requestBody with capture.mode=AUTOMATIC}</text></g><path d="M25,1868.8438 L84.4429,1868.8438 L84.4429,1875.9766 L74.4429,1885.9766 L20,1885.9766 L20,1873.8438 A5,5 0 0 1 25,1868.8438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="411.0625" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="1868.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="1881.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136.125" x="99.4429" y="1881.0542">[Authorization Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="898.4297,1903.1094,888.4297,1907.1094,898.4297,1911.1094,894.4297,1907.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="892.4297" x2="1646.9419" y1="1907.1094" y2="1907.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.3901" x="904.4297" y="1902.0435">Error Response (400/500/etc.)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1932.2422,86.356,1936.2422,96.356,1940.2422,92.356,1936.2422" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="886.4297" y1="1936.2422" y2="1936.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="102.356" y="1931.1763">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1965.375" y2="1965.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1965.375" y2="1978.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1978.375" y2="1978.375"/><polygon fill="#181818" points="96.356,1974.375,86.356,1978.375,96.356,1982.375,92.356,1978.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1960.3091">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1700.8096" y1="1987.375" y2="1987.375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147.6621" x="25" y="1997.5854">[Authorization Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="898.4297,2109.1094,888.4297,2113.1094,898.4297,2117.1094,894.4297,2113.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="892.4297" x2="1651.9419" y1="2113.1094" y2="2113.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="904.4297" y="2017.2466">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.2227" x="904.4297" y="2032.3794">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351.603" x="904.4297" y="2047.5122">{payment_id, transaction: {status: "APPROVED", ...}}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="904.4297" y="2062.645">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.0728" x="904.4297" y="2077.7778">Note: With AUTOMATIC capture,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.9902" x="904.4297" y="2092.9106">authorization and capture happen</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.6855" x="904.4297" y="2108.0435">in the same request</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="2142.2422" y2="2142.2422"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="2142.2422" y2="2155.2422"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="2155.2422" y2="2155.2422"/><polygon fill="#181818" points="898.4297,2151.2422,888.4297,2155.2422,898.4297,2159.2422,894.4297,2155.2422" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="894.4297" y="2137.1763">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,2195.5078,86.356,2199.5078,96.356,2203.5078,92.356,2199.5078" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="886.4297" y1="2199.5078" y2="2199.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6543" x="102.356" y="2179.3091">Return *Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.4102" x="102.356" y="2194.4419">{PaymentID, Transaction.Status: "APPROVED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="2258.9063" y2="2258.9063"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="2258.9063" y2="2271.9063"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="2271.9063" y2="2271.9063"/><polygon fill="#181818" points="96.356,2267.9063,86.356,2271.9063,96.356,2275.9063,92.356,2271.9063" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="2223.5747">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.7988" x="92.356" y="2238.7075">- authorization != nil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.2725" x="92.356" y="2253.8403">- authorization.PaymentID != nil</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1720.8096" x="0" y="2314.4727"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="2314.4727" y2="2314.4727"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="2317.4727" y2="2317.4727"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="364.6191" x="678.0952" y="2303.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="346.0933" x="684.0952" y="2319.9731">Phase 3: Verify Payment State (Before Refund)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,2354.1719,1256.1748,2358.1719,1246.1748,2362.1719,1250.1748,2358.1719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="1252.1748" y1="2358.1719" y2="2358.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="92.356" y="2353.106">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,2383.3047,673.0752,2387.3047,683.0752,2391.3047,679.0752,2387.3047" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="1257.1748" y1="2387.3047" y2="2387.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="689.0752" y="2382.2388">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,2412.4375,1256.1748,2416.4375,1246.1748,2420.4375,1250.1748,2416.4375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="1252.1748" y1="2416.4375" y2="2416.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="674.0752" y="2411.3716">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,2441.5703,673.0752,2445.5703,683.0752,2449.5703,679.0752,2445.5703" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="1257.1748" y1="2445.5703" y2="2445.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="689.0752" y="2440.5044">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,2470.7031,1256.1748,2474.7031,1246.1748,2478.7031,1250.1748,2474.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="1252.1748" y1="2474.7031" y2="2474.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="674.0752" y="2469.6372">audience URL</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="2518.9688" y2="2518.9688"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="2518.9688" y2="2531.9688"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="2531.9688" y2="2531.9688"/><polygon fill="#181818" points="1279.1748,2527.9688,1269.1748,2531.9688,1279.1748,2535.9688,1275.1748,2531.9688" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1275.1748" y="2498.77">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1275.1748" y="2513.9028">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="2591.3672" y2="2591.3672"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="2591.3672" y2="2604.3672"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="2604.3672" y2="2604.3672"/><polygon fill="#181818" points="1279.1748,2600.3672,1269.1748,2604.3672,1279.1748,2608.3672,1275.1748,2604.3672" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="1275.1748" y="2556.0356">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="1275.1748" y="2571.1685">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="1275.1748" y="2586.3013">- Content-Type: application/json</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,2629.5,673.0752,2633.5,683.0752,2637.5,679.0752,2633.5" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="1257.1748" y1="2633.5" y2="2633.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="689.0752" y="2628.4341">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,2658.6328,1256.1748,2662.6328,1246.1748,2666.6328,1250.1748,2662.6328" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="1252.1748" y1="2662.6328" y2="2662.6328"/><ellipse cx="679.5752" cy="2653.1328" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="686.0752" y="2657.5669">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1635.9419,2687.7656,1645.9419,2691.7656,1635.9419,2695.7656,1639.9419,2691.7656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1641.9419" y1="2691.7656" y2="2691.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1275.1748" y="2686.6997">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1279.1748,2913.625,1269.1748,2917.625,1279.1748,2921.625,1275.1748,2917.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1273.1748" x2="1651.9419" y1="2917.625" y2="2917.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1285.1748" y="2715.8325">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.0288" x="1285.1748" y="2730.9653">Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1285.1748" y="2746.0981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1293.4395" y="2761.231">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.9028" x="1293.4395" y="2776.3638">status: "AUTHORIZED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.1909" x="1293.4395" y="2791.4966">capture.mode: "AUTOMATIC",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1293.4395" y="2806.6294">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335.1055" x="1301.7041" y="2821.7622">{type: "AUTHORIZATION", status: "APPROVED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1293.4395" y="2836.895">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1285.1748" y="2852.0278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1285.1748" y="2867.1606">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.9932" x="1285.1748" y="2882.2935">Note: Status may be "AUTHORIZED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.0718" x="1285.1748" y="2897.4263">or "CAPTURED" depending on timing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.5825" x="1285.1748" y="2912.5591">of automatic capture</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="2946.7578" y2="2946.7578"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="2946.7578" y2="2959.7578"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="2959.7578" y2="2959.7578"/><polygon fill="#181818" points="1279.1748,2955.7578,1269.1748,2959.7578,1279.1748,2963.7578,1275.1748,2959.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1275.1748" y="2941.6919">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,3000.0234,86.356,3004.0234,96.356,3008.0234,92.356,3004.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="1262.1748" y1="3004.0234" y2="3004.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="102.356" y="2983.8247">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362.5972" x="102.356" y="2998.9575">{Status: "AUTHORIZED", Capture.Mode: "AUTOMATIC"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="3093.6875" y2="3093.6875"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="3093.6875" y2="3106.6875"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="3106.6875" y2="3106.6875"/><polygon fill="#181818" points="96.356,3102.6875,86.356,3106.6875,96.356,3110.6875,92.356,3106.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="3028.0903">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.9438" x="92.356" y="3043.2231">- payment.Capture.Mode == "AUTOMATIC"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.6523" x="92.356" y="3058.356">- payment.Status == "AUTHORIZED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="92.356" y="3073.4888">- payment.Transactions.length &gt;= 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.1123" x="92.356" y="3088.6216">- payment.Transactions[0].Type == "AUTHORIZATION"</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1720.8096" x="0" y="3135.2539"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="3135.2539" y2="3135.2539"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="3138.2539" y2="3138.2539"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="202.9126" x="758.9485" y="3124.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="184.3867" x="764.9485" y="3140.7544">Phase 4: Refund Request</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="132.356" y1="3189.0859" y2="3189.0859"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="3189.0859" y2="3202.0859"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="3202.0859" y2="3202.0859"/><polygon fill="#181818" points="101.356,3198.0859,91.356,3202.0859,101.356,3206.0859,97.356,3202.0859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.5933" x="97.356" y="3168.8872">Prepare Refund:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.8076" x="97.356" y="3184.02">Call Refund(ctx, client, paymentID)</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,3232.2188,880.4297,3236.2188,870.4297,3240.2188,874.4297,3236.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="876.4297" y1="3236.2188" y2="3236.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.4082" x="97.356" y="3231.1528">Refund(ctx, client, paymentID)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,3261.3516,673.0752,3265.3516,683.0752,3269.3516,679.0752,3265.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="881.4297" y1="3265.3516" y2="3265.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="689.0752" y="3260.2856">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,3290.4844,880.4297,3294.4844,870.4297,3298.4844,874.4297,3294.4844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="876.4297" y1="3294.4844" y2="3294.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="674.0752" y="3289.4185">true</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,3319.6172,673.0752,3323.6172,683.0752,3327.6172,679.0752,3323.6172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="881.4297" y1="3323.6172" y2="3323.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="689.0752" y="3318.5513">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,3348.75,880.4297,3352.75,870.4297,3356.75,874.4297,3352.75" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="876.4297" y1="3352.75" y2="3352.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="674.0752" y="3347.6841">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="892.4297" x2="934.4297" y1="3397.0156" y2="3397.0156"/><line style="stroke:#181818;stroke-width:2;" x1="934.4297" x2="934.4297" y1="3397.0156" y2="3410.0156"/><line style="stroke:#181818;stroke-width:2;" x1="893.4297" x2="934.4297" y1="3410.0156" y2="3410.0156"/><polygon fill="#181818" points="903.4297,3406.0156,893.4297,3410.0156,903.4297,3414.0156,899.4297,3410.0156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="899.4297" y="3376.8169">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341.7451" x="899.4297" y="3391.9497">POST {audience}/v1/payments/{paymentId}/refund</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="892.4297" x2="934.4297" y1="3454.2813" y2="3454.2813"/><line style="stroke:#181818;stroke-width:2;" x1="934.4297" x2="934.4297" y1="3454.2813" y2="3467.2813"/><line style="stroke:#181818;stroke-width:2;" x1="893.4297" x2="934.4297" y1="3467.2813" y2="3467.2813"/><polygon fill="#181818" points="903.4297,3463.2813,893.4297,3467.2813,903.4297,3471.2813,899.4297,3467.2813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="899.4297" y="3434.0825">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.3965" x="899.4297" y="3449.2153">(paymentID + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="892.4297" x2="934.4297" y1="3541.8125" y2="3541.8125"/><line style="stroke:#181818;stroke-width:2;" x1="934.4297" x2="934.4297" y1="3541.8125" y2="3554.8125"/><line style="stroke:#181818;stroke-width:2;" x1="893.4297" x2="934.4297" y1="3554.8125" y2="3554.8125"/><polygon fill="#181818" points="903.4297,3550.8125,893.4297,3554.8125,903.4297,3558.8125,899.4297,3554.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="899.4297" y="3491.3481">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="899.4297" y="3506.481">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="899.4297" y="3521.6138">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="899.4297" y="3536.7466">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,3579.9453,673.0752,3583.9453,683.0752,3587.9453,679.0752,3583.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="881.4297" y1="3583.9453" y2="3583.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="689.0752" y="3578.8794">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="870.4297,3609.0781,880.4297,3613.0781,870.4297,3617.0781,874.4297,3613.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="876.4297" y1="3613.0781" y2="3613.0781"/><ellipse cx="679.5752" cy="3603.5781" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="686.0752" y="3608.0122">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1635.9419,3638.2109,1645.9419,3642.2109,1635.9419,3646.2109,1639.9419,3642.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="892.4297" x2="1641.9419" y1="3642.2109" y2="3642.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.751" x="899.4297" y="3637.145">POST /v1/payments/{paymentId}/refund</text></g><path d="M25,3657.2109 L84.4429,3657.2109 L84.4429,3664.3438 L74.4429,3674.3438 L20,3674.3438 L20,3662.2109 A5,5 0 0 1 25,3657.2109" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="486.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1680.8096" x="20" y="3657.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="3670.2778">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="95.9492" x="99.4429" y="3669.4214">[Refund Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="903.4297,3691.4766,893.4297,3695.4766,903.4297,3699.4766,899.4297,3695.4766" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="897.4297" x2="1646.9419" y1="3695.4766" y2="3695.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="909.4297" y="3690.4106">Error Response</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,3720.6094,91.356,3724.6094,101.356,3728.6094,97.356,3724.6094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="886.4297" y1="3724.6094" y2="3724.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="107.356" y="3719.5435">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="132.356" y1="3753.7422" y2="3753.7422"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="132.356" x2="132.356" y1="3753.7422" y2="3766.7422"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="91.356" x2="132.356" y1="3766.7422" y2="3766.7422"/><polygon fill="#181818" points="101.356,3762.7422,91.356,3766.7422,101.356,3770.7422,97.356,3766.7422" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="97.356" y="3748.6763">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1700.8096" y1="3775.7422" y2="3775.7422"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107.4863" x="25" y="3785.9526">[Refund Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="898.4297,3958.0078,888.4297,3962.0078,898.4297,3966.0078,894.4297,3962.0078" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="892.4297" x2="1651.9419" y1="3962.0078" y2="3962.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.0259" x="904.4297" y="3805.6138">200 OK / 201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.4897" x="904.4297" y="3820.7466">Refund Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="904.4297" y="3835.8794">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1914" x="912.6943" y="3851.0122">payment_id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.2192" x="912.6943" y="3866.145">transaction: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.6182" x="920.959" y="3881.2778">type: "REFUND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.7476" x="920.959" y="3896.4106">status: "REFUNDED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.3081" x="920.959" y="3911.5435">id: transaction_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.8306" x="920.959" y="3926.6763">amount: amount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="912.6943" y="3941.8091">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="904.4297" y="3956.9419">}</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="887.4297" x2="929.4297" y1="3991.1406" y2="3991.1406"/><line style="stroke:#181818;stroke-width:2;" x1="929.4297" x2="929.4297" y1="3991.1406" y2="4004.1406"/><line style="stroke:#181818;stroke-width:2;" x1="888.4297" x2="929.4297" y1="4004.1406" y2="4004.1406"/><polygon fill="#181818" points="898.4297,4000.1406,888.4297,4004.1406,898.4297,4008.1406,894.4297,4004.1406" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="894.4297" y="3986.0747">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,4044.4063,91.356,4048.4063,101.356,4052.4063,97.356,4048.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="886.4297" y1="4048.4063" y2="4048.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.9409" x="107.356" y="4028.2075">Return *RefundResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308.896" x="107.356" y="4043.3403">{PaymentId, Transaction.Status: "REFUNDED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4122.9375" y2="4122.9375"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4122.9375" y2="4135.9375"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4135.9375" y2="4135.9375"/><polygon fill="#181818" points="101.356,4131.9375,91.356,4135.9375,101.356,4139.9375,97.356,4135.9375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.5166" x="97.356" y="4072.4731">Log refund response details:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.9966" x="97.356" y="4087.606">- Refund ID (PaymentId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7183" x="97.356" y="4102.7388">- Refund Status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.3794" x="97.356" y="4117.8716">- Refund Amount</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1720.8096" x="0" y="4171.5039"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="4171.5039" y2="4171.5039"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1720.8096" y1="4174.5039" y2="4174.5039"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="393.5835" x="663.613" y="4160.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="375.0576" x="669.613" y="4177.0044">Phase 5: Verify Final Payment State (After Refund)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,4211.2031,1256.1748,4215.2031,1246.1748,4219.2031,1250.1748,4215.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="1252.1748" y1="4215.2031" y2="4215.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="97.356" y="4210.1372">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,4240.3359,673.0752,4244.3359,683.0752,4248.3359,679.0752,4244.3359" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="1257.1748" y1="4244.3359" y2="4244.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="689.0752" y="4239.27">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,4269.4688,1256.1748,4273.4688,1246.1748,4277.4688,1250.1748,4273.4688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="1252.1748" y1="4273.4688" y2="4273.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="674.0752" y="4268.4028">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="4317.7344" y2="4317.7344"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="4317.7344" y2="4330.7344"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="4330.7344" y2="4330.7344"/><polygon fill="#181818" points="1279.1748,4326.7344,1269.1748,4330.7344,1279.1748,4334.7344,1275.1748,4330.7344" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1275.1748" y="4297.5356">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1275.1748" y="4312.6685">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="4359.8672" y2="4359.8672"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="4359.8672" y2="4372.8672"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="4372.8672" y2="4372.8672"/><polygon fill="#181818" points="1279.1748,4368.8672,1269.1748,4372.8672,1279.1748,4376.8672,1275.1748,4372.8672" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5869" x="1275.1748" y="4354.8013">Set Headers</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="683.0752,4398,673.0752,4402,683.0752,4406,679.0752,4402" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="1257.1748" y1="4402" y2="4402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="689.0752" y="4396.9341">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1246.1748,4427.1328,1256.1748,4431.1328,1246.1748,4435.1328,1250.1748,4431.1328" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="667.0752" x2="1252.1748" y1="4431.1328" y2="4431.1328"/><ellipse cx="679.5752" cy="4421.6328" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="686.0752" y="4426.0669">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1635.9419,4456.2656,1645.9419,4460.2656,1635.9419,4464.2656,1639.9419,4460.2656" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1641.9419" y1="4460.2656" y2="4460.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1275.1748" y="4455.1997">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1279.1748,4727.5234,1269.1748,4731.5234,1279.1748,4735.5234,1275.1748,4731.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1273.1748" x2="1651.9419" y1="4731.5234" y2="4731.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1285.1748" y="4484.3325">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.0679" x="1285.1748" y="4499.4653">Final Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1285.1748" y="4514.5981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1293.4395" y="4529.731">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.7476" x="1293.4395" y="4544.8638">status: "REFUNDED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.1909" x="1293.4395" y="4559.9966">capture.mode: "AUTOMATIC",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1293.4395" y="4575.1294">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339.2378" x="1301.7041" y="4590.2622">{type: "AUTHORIZATION", status: "APPROVED", ...},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.564" x="1301.7041" y="4605.395">{type: "CAPTURE", status: "CAPTURED", ...},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.5693" x="1301.7041" y="4620.5278">{type: "REFUND", status: "REFUNDED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1293.4395" y="4635.6606">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1285.1748" y="4650.7935">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1285.1748" y="4665.9263">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.9502" x="1285.1748" y="4681.0591">Note: Transactions include:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224.0977" x="1285.1748" y="4696.1919">- AUTHORIZATION (auto-captured)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.354" x="1285.1748" y="4711.3247">- CAPTURE (automatic)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.7974" x="1285.1748" y="4726.4575">- REFUND</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1268.1748" x2="1310.1748" y1="4760.6563" y2="4760.6563"/><line style="stroke:#181818;stroke-width:2;" x1="1310.1748" x2="1310.1748" y1="4760.6563" y2="4773.6563"/><line style="stroke:#181818;stroke-width:2;" x1="1269.1748" x2="1310.1748" y1="4773.6563" y2="4773.6563"/><polygon fill="#181818" points="1279.1748,4769.6563,1269.1748,4773.6563,1279.1748,4777.6563,1275.1748,4773.6563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1275.1748" y="4755.5903">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,4859.3203,91.356,4863.3203,101.356,4867.3203,97.356,4863.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="1262.1748" y1="4863.3203" y2="4863.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="107.356" y="4797.7231">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.3018" x="107.356" y="4812.856">with transactions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.146" x="107.356" y="4827.9888">- AUTHORIZATION transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.9224" x="107.356" y="4843.1216">- CAPTURE transaction (automatic)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.3657" x="107.356" y="4858.2544">- REFUND transaction</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4968.1172" y2="4968.1172"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4968.1172" y2="4981.1172"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4981.1172" y2="4981.1172"/><polygon fill="#181818" points="101.356,4977.1172,91.356,4981.1172,101.356,4985.1172,97.356,4981.1172" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.0796" x="97.356" y="4887.3872">Verify Final State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="97.356" y="4902.52">- payment.Transactions.length &gt;= 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336.7686" x="97.356" y="4917.6528">- payment.Transactions includes "AUTHORIZATION"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288.5264" x="97.356" y="4932.7856">- payment.Transactions includes "CAPTURE"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.9883" x="97.356" y="4947.9185">- payment.Transactions includes "REFUND"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.4971" x="97.356" y="4963.0513">- payment.Status == "REFUNDED"</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="5040.5156" y2="5040.5156"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="5040.5156" y2="5053.5156"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="5053.5156" y2="5053.5156"/><polygon fill="#181818" points="101.356,5049.5156,91.356,5053.5156,101.356,5057.5156,97.356,5053.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="97.356" y="5005.1841">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.9434" x="97.356" y="5020.3169">- lastPaymentState.Status == "REFUNDED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.5957" x="97.356" y="5035.4497">(expected payment status to be REFUNDED)</text></g><path d="M95,5071.5156 L95,5237.5156 A5,5 0 0 0 100,5242.5156 L799,5242.5156 A5,5 0 0 0 804,5237.5156 L804,5076.5156 L794,5066.5156 L100,5066.5156 A5,5 0 0 0 95,5071.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M794,5066.5156 L794,5074.0156 A2.5,2.5 0 0 0 796.5,5076.5156 L804,5076.5156 L794,5066.5156" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="236.939" x="101" y="5083.5825">Key Points of Auto Refund Flow:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312.1714" x="101" y="5098.7153">1. Authorization with AUTOMATIC capture mode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380.085" x="101" y="5113.8481">2. Payment is automatically captured during authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="688.0859" x="101" y="5128.981">3. Payment has status "AUTHORIZED" after authorization\n   (may show CAPTURED depending on timing)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.2197" x="101" y="5144.1138">4. Refund is applied to a captured payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328.98" x="101" y="5159.2466">5. Payment has multiple transactions after refund:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328.834" x="113.397" y="5174.3794">- AUTHORIZATION transaction (status: APPROVED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354.1675" x="113.397" y="5189.5122">- CAPTURE transaction (status: CAPTURED, automatic)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.2979" x="113.397" y="5204.645">- REFUND transaction (status: REFUNDED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.3691" x="101" y="5219.7778">6. Final payment status is "REFUNDED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="521.4854" x="101" y="5234.9106">7. Refund returns money to the customer for\n   a previously captured payment</text><!--SRC=[vLdhRziu4l-kluAN-sBd73d9jdU0WIpWEaxhRPCOYTq5ThqeM8c9TP4fdnvElO7_zvlXGoBri9NTUoomBThOv0mvpz_CC6cGXemCitGPnS6lD0qYJgx2w9cSu694HdITPZ4ZbFlaZZrat7USv2dWQnhJ5KdOlpB6FJQCu-XvjWoy9ywIX9mR9744F5uKSnQJirDZuolrdXx5xYWAevZyzMg8Vns7UYbyFPgn92LN6VTGfYD24u8h3Z2dWHUiAK_9qOG7QK33u5SsfTiLuocABcXn1x_OzFGfe-ue381IKCcFDerbYsaSRGAVnO8QT_I2pQDkJopoycBf6X253ASJUJ9yWS-ESt51fakQC78s8BboqYiN5uumoSdtkN86ZMc0ZfT-ww8PWmrDMM4AHtzgEcFCDvzf7D2l8KiwtGN_556Vk8nlo4CGCejTMcv0RjYp_DWnRbHcbJzCQd4Wd1V44KTfoKPVDrXmYBYFy-6NqQV9-6RsPN9PNhaVZ-x6itnrEB-4vT4uNxYzUp-ycVmqd4rkRopss-lhyTre36ir8dq6pNqKceOXYeOY9OH2o2UiKC4osB5QxK2OCeZykEluhAoyGyDKVIQZcAdCec17to7mfp0cd8sE7K1-GQfnCiOZ1OrnQkv4N9TnaFEbxXLDQTW1MReE2nDctSjySfzv7kJbGnQ6szBbjcz-U4vdqHFZu4maA-k4Q-A_gXcdCLkZqMunIKYCk00oVetyROb1XJfmtDxFI3-YGDzFyLBxIfqI-Prepnz-d14X8DXAtc1O5FyeBc4SBPgm9p0awuWdB2UjTMt51IKt68OexPZojlNlFXyVyZFk2ryNDb5ktckCyzCp7HOB_a85mnTX_XvnNNVNHhMgz-y1iI63ZDFscxcGEOIeC_nNRsh6_I8Ewa4CSAWMk5KaDpALGRf2N_PUnnDozGWrga6Fh4ldz0WFmcvZ5gD61TYV3qeLM4Ttnwp1NRC4I9bqrcbkfXWbcgwWk0BHooYBOwZIsm4vcjzV7lKGyp8sW79ykaF22K-55u-eASGHRbsps5j2lPhu0o8LTz-pj5Z5Ad6Y1NIl8n-EFHhEPxVN0CEZ8tbwaiRPIjmmeh4FzaWXQPEYN8YwdcjcLjd2BWoBMezeuok0CMgELPmTyviPg01maqH0_fvwLH42v6Vz1mhPrWJqHK1F-0QF5vwtfSYz9W10_00smNKJfVSiBKUBfL8ht2_4-DmWH5crVoOHTw-Xv2tX86NLIpYrMykhpGWnCCpy05k_FQMYqPvKyPBvtIUdEUrRY2-XZ7oOpQQoeAW4M73nxKNVjEjlplfMU2SjJd_Fe6iLUUkprJfACObEFhBjWdUeI2vtWvb4_aRIO0MtqjNQdVFWsmtbKQVRRN43U9ryO021iUg0J147v1s3x8x9Yu1KcQks993TJsmhTaQHIEEJsNODIKZNwp3mn35zz76pGGsVVaZJTTxDlTghnqjWTmtArtZLxWegpe9QfOBp7RGKv3c09iDJgBC2rBd8CMVNeeqeZJlDBOIjeDr8aCwRqzF-M_Z7Ki_j5lprIN-e-9UBx3uSQDqRs8hkwmziJQqkeLoQfFhW4LNplWH-3o2IyeHwCcnV81NIBC5IC9tUtNuUOz71xW82TO5W1m7w8xemzvfsPc_1BSUBkLFjaIK4DOC30axI9VJdTCLq8MXZqGOFrIBYdAzoJ9JwjdNmiMKki9BgC2QNFJ8hZEJULqoqQ-txKX1e2OP9mc9P-sqZ_kK2kv7AkfkBfYZoPijkJxw3AOd5mSDMZxG4XOS4UCSUiE-Jxm9MUr9kgmIygCLtM-WRh6g-rd8ODRaoFJlbbTzIrwjoOMslg-hxRhFBtwkkiqfVoskhfvXbx_tOg7hunIvwkZ7jwtIT-BkMjxowE1qeGOTiQfMVLrdLAZqjhPgN7BHPewKgQEAOg5cLvFpqbDn-XFP3POg6Ip3Wou8J4a0ZRU0cBXLWEPzzkBsR_8HmYHjcWRFQQh5h82um_unB19mXJ9yV9Hv307oR01cvVbbm0vSbBf4LtPAlp99fmV5PRZISpkPty1LG2j3O3_WZ0OY11WW-0Sa3Oaoq0hTxMW6d1fHRXc0Z65VPAq2iIC3mztKMRfvQTgR0LHng15tbLzSy642nF11fCcLfHL1OkQ0mwaNYXem_Gidy_eASDT7yVFgBYxbddIb3m83pDmE5sFcOsJXNIZfGReIlO_BROUZUDy-rFUE_FSxLeKIxQQVrDOUW_ZyusTH1Lp-Mp_M_USJ9tT8ut_nHPXkdxKpJsdU72ihX-MMVIwfeY5E9IafZ76axYZYlcJiQEkJVzUwWH3S7Z7t31PP8qhUdZ1oIyl42QrDHAYjbqvuuPFbJrUzkV3M_KKNKgAzoUPnluA76AVfWc17LovdyYMiGXRjzrdD-vrnnOAQGnZ5iepjtls6eo5NT7NIkKnqaFaMFH8OgqMBgLpkHoSfNW0oTN92kiI75C1RaKsHfh7YRZnLN0QTXURWOFgGi_lFC5d-09lzFrQ3RCVUQDjs6aVz1azwpsLG7RZBaJNajWuR3EXKQfW2pgoG1zyBCPxA8cpAJ3lRw9ye44WAKA79BZ04I6SID_-z9GBmRMZwfwcHic_eOo_MwcHIl6I0i31JODsWn0vmtqMXl9UNuQi6W8wi5gOgfXdacZwyzqr984utQGkjQVcX3sRSry_2tsEeU5SKaZN10rPHTn-4GkIGE7fSfWIbqfby5Zu-XboJJA00Vu8RubPhkjV3NWCV7WkxCBJsNFjU-K19CTC5mxkRm4IJ5r0kJqbOJ-yJFOfoGhNStmVrTmGtLK2jbJeA4YWf8xVT4OEtWS9uiesSTd9TrixXiBDwuMbUK4Hjd40eCG0iHbLq5-LjRgbKMfi4wP5REABbaWp3GRv5xqeXqDF1eOEiMNBNvfUcrVht2l0PhDUyApY8kaFRlhiglKWm5YHchIFcFt5wn00-mGSGXVi1a-ERiPGd80Te_HB7m1INhc6s2A4jChskJWay8XkM_0G00]--></g></svg>