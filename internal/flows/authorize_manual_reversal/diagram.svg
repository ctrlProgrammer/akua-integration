<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="5066px" preserveAspectRatio="none" style="width:1770px;height:5066px;background:#FAFAFA;" version="1.1" viewBox="0 0 1770 5066" width="1770px" zoomAndPan="magnify"><title>Authorization Flow - Manual Reversal</title><defs/><g><rect fill="#FAFAFA" height="5066" style="stroke:none;stroke-width:1;" width="1770" x="0" y="0"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="295.6133" x="733.2244" y="27.9951">Authorization Flow - Manual Reversal</text><g><title>Test Function</title><rect fill="#FFFFFF" height="3730.3359" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="1895.5625" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3081.0234"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="478.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2326.7734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2385.0391"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2572.9688"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3144.2891"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3202.5547"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3462.8828"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4123.2734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4280.9375"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="3115.1563"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="585.3203" style="stroke:#181818;stroke-width:1;" width="10" x="1285.0278" y="2297.6406"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="542.1875" style="stroke:#181818;stroke-width:1;" width="10" x="1285.0278" y="4094.1406"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="165.3281" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="2631.2344"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="3521.1484"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="180.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="4339.2031"/></g><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1743.062" x="10" y="483.3203"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="693.9219"/><rect fill="none" height="872.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1743.062" x="10" y="1353.6484"/><rect fill="none" height="350.5313" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="1868.8438"/><rect fill="none" height="486.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="3536.1484"/><g><title>Test Function</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="76.356" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="118.5938" y2="4985.5859"/></g><g><title>InitializePaymentFlow</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="479.4683" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="483.2339" x2="483.2339" y1="118.5938" y2="4985.5859"/></g><g><title>akua.Client</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="673.0752" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="676.5156" x2="676.5156" y1="118.5938" y2="4985.5859"/></g><g><title>AuthorizationProvider</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="893.4297" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="896.4482" x2="896.4482" y1="118.5938" y2="4985.5859"/></g><g><title>PaymentsProvider</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="1286.0278" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1289.3237" x2="1289.3237" y1="118.5938" y2="4985.5859"/></g><g><title>Akua API</title><rect fill="#000000" fill-opacity="0.00000" height="4866.9922" width="8" x="1691.1943" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1694.3267" x2="1694.3267" y1="118.5938" y2="4985.5859"/></g><g class="participant participant-head" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="115.292">Test Function</text><ellipse cx="80.356" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,58.7969 L80.356,85.7969 M67.356,66.7969 L93.356,66.7969 M80.356,85.7969 L67.356,100.7969 M80.356,85.7969 L93.356,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Test"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.7119" x="30" y="4997.5811">Test Function</text><ellipse cx="80.356" cy="5009.3828" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M80.356,5017.3828 L80.356,5044.3828 M67.356,5025.3828 L93.356,5025.3828 M80.356,5044.3828 L67.356,5059.3828 M80.356,5044.3828 L93.356,5059.3828" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="400.2339" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="407.2339" y="107.292">InitializePaymentFlow</text></g><g class="participant participant-tail" data-participant="InitFlow"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="166.4688" x="400.2339" y="4984.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.4688" x="407.2339" y="5004.5811">InitializePaymentFlow</text></g><g class="participant participant-head" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="630.5156" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="637.5156" y="107.292">akua.Client</text></g><g class="participant participant-tail" data-participant="Client"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="93.1191" x="630.5156" y="4984.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79.1191" x="637.5156" y="5004.5811">akua.Client</text></g><g class="participant participant-head" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="814.4482" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="821.4482" y="107.292">AuthorizationProvider</text></g><g class="participant participant-tail" data-participant="AuthProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="165.9629" x="814.4482" y="4984.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.9629" x="821.4482" y="5004.5811">AuthorizationProvider</text></g><g class="participant participant-head" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1219.3237" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1226.3237" y="107.292">PaymentsProvider</text></g><g class="participant participant-tail" data-participant="PaymentsProvider"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="141.4082" x="1219.3237" y="4984.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4082" x="1226.3237" y="5004.5811">PaymentsProvider</text></g><g class="participant participant-head" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1657.3267" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1664.3267" y="107.292">Akua API</text></g><g class="participant participant-tail" data-participant="AkuaAPI"><rect fill="#E2E2F0" height="30.2969" rx="5" ry="5" style="stroke:#181818;stroke-width:0.5;" width="75.7354" x="1657.3267" y="4984.5859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7354" x="1664.3267" y="5004.5811">Akua API</text></g><g><title>Test Function</title><rect fill="#FFFFFF" height="3730.3359" style="stroke:#181818;stroke-width:1;" width="10" x="75.356" y="1246.25"/></g><g><title>Test Function</title><rect fill="#FFFFFF" height="1895.5625" style="stroke:#181818;stroke-width:1;" width="10" x="80.356" y="3081.0234"/></g><g><title>InitializePaymentFlow</title><rect fill="#FFFFFF" height="328.7266" style="stroke:#181818;stroke-width:1;" width="10" x="478.4683" y="192.8594"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="189.0625" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="279.2578"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="153.6641" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="607.6563"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1309.5156"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1520.1172"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="1780.4453"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2326.7734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2385.0391"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="2572.9688"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3144.2891"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3202.5547"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="3462.8828"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4123.2734"/></g><g><title>akua.Client</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="672.0752" y="4280.9375"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="111.5313" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="1280.3828"/></g><g><title>AuthorizationProvider</title><rect fill="#FFFFFF" height="488.3906" style="stroke:#181818;stroke-width:1;" width="10" x="892.4297" y="3115.1563"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="585.3203" style="stroke:#181818;stroke-width:1;" width="10" x="1285.0278" y="2297.6406"/></g><g><title>PaymentsProvider</title><rect fill="#FFFFFF" height="542.1875" style="stroke:#181818;stroke-width:1;" width="10" x="1285.0278" y="4094.1406"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="678.9219"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="1853.8438"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="165.3281" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="2631.2344"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="82.3984" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="3521.1484"/></g><g><title>Akua API</title><rect fill="#FFFFFF" height="180.4609" style="stroke:#181818;stroke-width:1;" width="10" x="1690.1943" y="4339.2031"/></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1763.062" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="178.0298" x="792.5161" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159.5039" x="798.5161" y="154.6606">Phase 1: Initialization</text><g class="message" data-participant-1="Test" data-participant-2="InitFlow"><polygon fill="#181818" points="466.4683,188.8594,476.4683,192.8594,466.4683,196.8594,470.4683,192.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="472.4683" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.6597" x="87.356" y="187.7935">InitializePaymentFlow(ctx)</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="488.4683" x2="530.4683" y1="237.125" y2="237.125"/><line style="stroke:#181818;stroke-width:2;" x1="530.4683" x2="530.4683" y1="237.125" y2="250.125"/><line style="stroke:#181818;stroke-width:2;" x1="489.4683" x2="530.4683" y1="250.125" y2="250.125"/><polygon fill="#181818" points="499.4683,246.125,489.4683,250.125,499.4683,254.125,495.4683,250.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.1128" x="495.4683" y="216.9263">InitializeEnvVariables()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.5405" x="495.4683" y="232.0591">Load .env file</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="660.0752,275.2578,670.0752,279.2578,660.0752,283.2578,664.0752,279.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="488.4683" x2="666.0752" y1="279.2578" y2="279.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.1338" x="495.4683" y="274.1919">NewClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="384.0547" y2="384.0547"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="384.0547" y2="397.0547"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="397.0547" y2="397.0547"/><polygon fill="#181818" points="693.0752,393.0547,683.0752,397.0547,693.0752,401.0547,689.0752,397.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.3545" x="689.0752" y="303.3247">Load environment variables:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.5269" x="689.0752" y="318.4575">- AKUA_CLIENT_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.4131" x="689.0752" y="333.5903">- AKUA_CLIENT_SECRET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.6313" x="689.0752" y="348.7231">- AKUA_AUDIENCE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.8149" x="689.0752" y="363.856">- AKUA_ORGANIZATION_ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.7734" x="689.0752" y="378.9888">- AKUA_COMMERCE_ID</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="426.1875" y2="426.1875"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="426.1875" y2="439.1875"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="439.1875" y2="439.1875"/><polygon fill="#181818" points="693.0752,435.1875,683.0752,439.1875,693.0752,443.1875,689.0752,439.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.1333" x="689.0752" y="421.1216">Validate all env vars are set</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="499.4683,464.3203,489.4683,468.3203,499.4683,472.3203,495.4683,468.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="493.4683" x2="676.0752" y1="468.3203" y2="468.3203"/><ellipse cx="510.9683" cy="458.8203" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3276" x="517.4683" y="463.2544">Client (or error)</text></g><path d="M15,483.3203 L74.4429,483.3203 L74.4429,490.4531 L64.4429,500.4531 L10,500.4531 L10,488.3203 A5,5 0 0 1 15,483.3203" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="608" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1743.062" x="10" y="483.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="496.3872">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144.4878" x="89.4429" y="495.5308">[Client Creation Failed]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,517.5859,81.356,521.5859,91.356,525.5859,87.356,521.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="521.5859" y2="521.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="516.52">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="550.7188" y2="550.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="550.7188" y2="563.7188"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="563.7188" y2="563.7188"/><polygon fill="#181818" points="91.356,559.7188,81.356,563.7188,91.356,567.7188,87.356,563.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="545.6528">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1753.062" y1="572.7188" y2="572.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179.5288" x="15" y="582.9292">[Client Created Successfully]</text><g class="message" data-participant-1="InitFlow" data-participant-2="Client"><polygon fill="#181818" points="660.0752,603.6563,670.0752,607.6563,660.0752,611.6563,664.0752,607.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="666.0752" y1="607.6563" y2="607.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="490.4683" y="602.5903">LoadJwtToken()</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="724.0752" y1="636.7891" y2="636.7891"/><line style="stroke:#181818;stroke-width:2;" x1="724.0752" x2="724.0752" y1="636.7891" y2="649.7891"/><line style="stroke:#181818;stroke-width:2;" x1="683.0752" x2="724.0752" y1="649.7891" y2="649.7891"/><polygon fill="#181818" points="693.0752,645.7891,683.0752,649.7891,693.0752,653.7891,689.0752,649.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.6943" x="689.0752" y="631.7231">Prepare OAuth request body</text></g><g class="message" data-participant-1="Client" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1678.1943,674.9219,1688.1943,678.9219,1678.1943,682.9219,1682.1943,678.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="682.0752" x2="1684.1943" y1="678.9219" y2="678.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.4688" x="689.0752" y="673.856">POST /oauth/token</text></g><path d="M25,693.9219 L84.4429,693.9219 L84.4429,701.0547 L74.4429,711.0547 L20,711.0547 L20,698.9219 A5,5 0 0 1 25,693.9219" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="693.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="706.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="171.6548" x="99.4429" y="706.1323">[JWT Token Request Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="693.0752,728.1875,683.0752,732.1875,693.0752,736.1875,689.0752,732.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="687.0752" x2="1689.1943" y1="732.1875" y2="732.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="699.0752" y="727.1216">Error Response</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="494.4683,757.3203,484.4683,761.3203,494.4683,765.3203,490.4683,761.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="488.4683" x2="676.0752" y1="761.3203" y2="761.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="500.4683" y="756.2544">Return Error</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,786.4531,81.356,790.4531,91.356,794.4531,87.356,790.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="790.4531" y2="790.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="97.356" y="785.3872">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="80.356" x2="122.356" y1="819.5859" y2="819.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="122.356" x2="122.356" y1="819.5859" y2="832.5859"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="81.356" x2="122.356" y1="832.5859" y2="832.5859"/><polygon fill="#181818" points="91.356,828.5859,81.356,832.5859,91.356,836.5859,87.356,832.5859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="87.356" y="814.52">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1743.062" y1="841.5859" y2="841.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.4604" x="25" y="851.7964">[JWT Token Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="Client"><polygon fill="#181818" points="688.0752,887.6563,678.0752,891.6563,688.0752,895.6563,684.0752,891.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="682.0752" x2="1694.1943" y1="891.6563" y2="891.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="694.0752" y="871.4575">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.3252" x="694.0752" y="886.5903">{access_token, ...}</text></g><g class="message" data-participant-1="Client" data-participant-2="Client"><line style="stroke:#181818;stroke-width:2;" x1="677.0752" x2="719.0752" y1="920.7891" y2="920.7891"/><line style="stroke:#181818;stroke-width:2;" x1="719.0752" x2="719.0752" y1="920.7891" y2="933.7891"/><line style="stroke:#181818;stroke-width:2;" x1="678.0752" x2="719.0752" y1="933.7891" y2="933.7891"/><polygon fill="#181818" points="688.0752,929.7891,678.0752,933.7891,688.0752,937.7891,684.0752,933.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.8994" x="684.0752" y="915.7231">Store access_token</text></g><g class="message" data-participant-1="Client" data-participant-2="InitFlow"><polygon fill="#181818" points="494.4683,958.9219,484.4683,962.9219,494.4683,966.9219,490.4683,962.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="488.4683" x2="676.0752" y1="962.9219" y2="962.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.5874" x="500.4683" y="957.856">JWT Token loaded</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="525.4683" y1="999.0547" y2="999.0547"/><line style="stroke:#181818;stroke-width:2;" x1="525.4683" x2="525.4683" y1="999.0547" y2="1012.0547"/><line style="stroke:#181818;stroke-width:2;" x1="484.4683" x2="525.4683" y1="1012.0547" y2="1012.0547"/><polygon fill="#181818" points="494.4683,1008.0547,484.4683,1012.0547,494.4683,1016.0547,490.4683,1012.0547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.6069" x="490.4683" y="993.9888">NewAuthorizationProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="InitFlow"><line style="stroke:#181818;stroke-width:2;" x1="483.4683" x2="525.4683" y1="1041.1875" y2="1041.1875"/><line style="stroke:#181818;stroke-width:2;" x1="525.4683" x2="525.4683" y1="1041.1875" y2="1054.1875"/><line style="stroke:#181818;stroke-width:2;" x1="484.4683" x2="525.4683" y1="1054.1875" y2="1054.1875"/><polygon fill="#181818" points="494.4683,1050.1875,484.4683,1054.1875,494.4683,1058.1875,490.4683,1054.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.8062" x="490.4683" y="1036.1216">NewPaymentsProvider()</text></g><g class="message" data-participant-1="InitFlow" data-participant-2="Test"><polygon fill="#181818" points="91.356,1079.3203,81.356,1083.3203,91.356,1087.3203,87.356,1083.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="482.4683" y1="1083.3203" y2="1083.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336.4893" x="97.356" y="1078.2544">Return (client, authProvider, paymentsProvider, nil)</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1763.062" x="0" y="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="1118.8867" y2="1118.8867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="1121.8867" y2="1121.8867"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="250.3931" x="756.3345" y="1108.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="231.8672" x="762.3345" y="1124.3872">Phase 2: Authorization Request</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="80.356" x2="127.356" y1="1233.25" y2="1233.25"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="1233.25" y2="1246.25"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="1246.25" y2="1246.25"/><polygon fill="#181818" points="96.356,1242.25,86.356,1246.25,96.356,1250.25,92.356,1246.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.8462" x="92.356" y="1152.52">Prepare AuthorizeRequest:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.5942" x="92.356" y="1167.6528">- Amount: {Currency: "USD", Value: 100}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.9434" x="92.356" y="1182.7856">- Intent: "authorization"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.1548" x="92.356" y="1197.9185">- MerchantId: client.GetMerchantId()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.3062" x="92.356" y="1213.0513">- Capture.Mode: "MANUAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.9434" x="92.356" y="1228.1841">- Instrument: Card details</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,1276.3828,890.4297,1280.3828,880.4297,1284.3828,884.4297,1280.3828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="886.4297" y1="1280.3828" y2="1280.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.2192" x="92.356" y="1275.3169">Authorize(ctx, client, request)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1305.5156,683.0752,1309.5156,693.0752,1313.5156,689.0752,1309.5156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="1309.5156" y2="1309.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="1304.4497">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,1334.6484,890.4297,1338.6484,880.4297,1342.6484,884.4297,1338.6484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="1338.6484" y2="1338.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.9849" x="684.0752" y="1333.5825">true/false</text></g><path d="M15,1353.6484 L74.4429,1353.6484 L74.4429,1360.7813 L64.4429,1370.7813 L10,1370.7813 L10,1358.6484 A5,5 0 0 1 15,1353.6484" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="872.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1743.062" x="10" y="1353.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="1366.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.043" x="89.4429" y="1365.8589">[JWT Token Invalid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1387.9141,86.356,1391.9141,96.356,1395.9141,92.356,1391.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="1391.9141" y2="1391.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.0288" x="102.356" y="1386.8481">Error: ErrJWTTokenNotSet</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1421.0469" y2="1421.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1421.0469" y2="1434.0469"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1434.0469" y2="1434.0469"/><polygon fill="#181818" points="96.356,1430.0469,86.356,1434.0469,96.356,1438.0469,92.356,1434.0469" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1415.981">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="1753.062" y1="1443.0469" y2="1443.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110.4619" x="15" y="1453.2573">[JWT Token Valid]</text><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1477.9844" y2="1477.9844"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1477.9844" y2="1490.9844"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1490.9844" y2="1490.9844"/><polygon fill="#181818" points="908.4297,1486.9844,898.4297,1490.9844,908.4297,1494.9844,904.4297,1490.9844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172.7134" x="904.4297" y="1472.9185">json.Marshal(requestData)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1516.1172,683.0752,1520.1172,693.0752,1524.1172,689.0752,1520.1172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="896.4297" y1="1520.1172" y2="1520.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="1515.0513">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="885.4297,1545.25,895.4297,1549.25,885.4297,1553.25,889.4297,1549.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="891.4297" y1="1549.25" y2="1549.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="1544.1841">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1593.5156" y2="1593.5156"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1593.5156" y2="1606.5156"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1606.5156" y2="1606.5156"/><polygon fill="#181818" points="908.4297,1602.5156,898.4297,1606.5156,908.4297,1610.5156,904.4297,1606.5156" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="904.4297" y="1573.3169">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232.0322" x="904.4297" y="1588.4497">POST {audience}/v1/authorizations</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1650.7813" y2="1650.7813"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1650.7813" y2="1663.7813"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1663.7813" y2="1663.7813"/><polygon fill="#181818" points="908.4297,1659.7813,898.4297,1663.7813,908.4297,1667.7813,904.4297,1663.7813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="904.4297" y="1630.5825">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.4429" x="904.4297" y="1645.7153">(amount.value + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="1738.3125" y2="1738.3125"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="1738.3125" y2="1751.3125"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="1751.3125" y2="1751.3125"/><polygon fill="#181818" points="908.4297,1747.3125,898.4297,1751.3125,908.4297,1755.3125,904.4297,1751.3125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="904.4297" y="1687.8481">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="904.4297" y="1702.981">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="904.4297" y="1718.1138">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="904.4297" y="1733.2466">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,1776.4453,683.0752,1780.4453,693.0752,1784.4453,689.0752,1780.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="896.4297" y1="1780.4453" y2="1780.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="1775.3794">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="885.4297,1805.5781,895.4297,1809.5781,885.4297,1813.5781,889.4297,1809.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="891.4297" y1="1809.5781" y2="1809.5781"/><ellipse cx="689.5752" cy="1800.0781" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="1804.5122">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1678.1943,1849.8438,1688.1943,1853.8438,1678.1943,1857.8438,1682.1943,1853.8438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="1684.1943" y1="1853.8438" y2="1853.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0381" x="904.4297" y="1833.645">POST /v1/authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292.3286" x="904.4297" y="1848.7778">{requestBody with capture.mode=MANUAL}</text></g><path d="M25,1868.8438 L84.4429,1868.8438 L84.4429,1875.9766 L74.4429,1885.9766 L20,1885.9766 L20,1873.8438 A5,5 0 0 1 25,1868.8438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="350.5313" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="1868.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="1881.9106">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136.125" x="99.4429" y="1881.0542">[Authorization Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,1903.1094,898.4297,1907.1094,908.4297,1911.1094,904.4297,1907.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1689.1943" y1="1907.1094" y2="1907.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.3901" x="914.4297" y="1902.0435">Error Response (400/500/etc.)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,1932.2422,86.356,1936.2422,96.356,1940.2422,92.356,1936.2422" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="1936.2422" y2="1936.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="102.356" y="1931.1763">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="85.356" x2="127.356" y1="1965.375" y2="1965.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="127.356" x2="127.356" y1="1965.375" y2="1978.375"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="86.356" x2="127.356" y1="1978.375" y2="1978.375"/><polygon fill="#181818" points="96.356,1974.375,86.356,1978.375,96.356,1982.375,92.356,1978.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="92.356" y="1960.3091">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1743.062" y1="1987.375" y2="1987.375"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147.6621" x="25" y="1997.5854">[Authorization Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,2048.5781,898.4297,2052.5781,908.4297,2056.5781,904.4297,2052.5781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1694.1943" y1="2052.5781" y2="2052.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.6787" x="914.4297" y="2017.2466">201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.2227" x="914.4297" y="2032.3794">Authorization Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367.0024" x="914.4297" y="2047.5122">{payment_id, transaction: {status: "AUTHORIZED", ...}}</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="2081.7109" y2="2081.7109"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="2081.7109" y2="2094.7109"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="2094.7109" y2="2094.7109"/><polygon fill="#181818" points="908.4297,2090.7109,898.4297,2094.7109,908.4297,2098.7109,904.4297,2094.7109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="904.4297" y="2076.645">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,2134.9766,86.356,2138.9766,96.356,2142.9766,92.356,2138.9766" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="896.4297" y1="2138.9766" y2="2138.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.6543" x="102.356" y="2118.7778">Return *Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324.8096" x="102.356" y="2133.9106">{PaymentID, Transaction.Status: "AUTHORIZED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="2198.375" y2="2198.375"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="2198.375" y2="2211.375"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="2211.375" y2="2211.375"/><polygon fill="#181818" points="96.356,2207.375,86.356,2211.375,96.356,2215.375,92.356,2211.375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="2163.0435">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.7988" x="92.356" y="2178.1763">- authorization != nil</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.2725" x="92.356" y="2193.3091">- authorization.PaymentID != nil</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1763.062" x="0" y="2253.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="2253.9414" y2="2253.9414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="2256.9414" y2="2256.9414"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="375.8164" x="693.6228" y="2243.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="357.2905" x="699.6228" y="2259.4419">Phase 3: Verify Payment State (Before Reversal)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,2293.6406,1283.0278,2297.6406,1273.0278,2301.6406,1277.0278,2297.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="1279.0278" y1="2297.6406" y2="2297.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="92.356" y="2292.5747">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2322.7734,683.0752,2326.7734,693.0752,2330.7734,689.0752,2326.7734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1284.0278" y1="2326.7734" y2="2326.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="2321.7075">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,2351.9063,1283.0278,2355.9063,1273.0278,2359.9063,1277.0278,2355.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1279.0278" y1="2355.9063" y2="2355.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="2350.8403">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2381.0391,683.0752,2385.0391,693.0752,2389.0391,689.0752,2385.0391" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1284.0278" y1="2385.0391" y2="2385.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="2379.9731">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,2410.1719,1283.0278,2414.1719,1273.0278,2418.1719,1277.0278,2414.1719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1279.0278" y1="2414.1719" y2="2414.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="2409.106">audience URL</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="2458.4375" y2="2458.4375"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="2458.4375" y2="2471.4375"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="2471.4375" y2="2471.4375"/><polygon fill="#181818" points="1306.0278,2467.4375,1296.0278,2471.4375,1306.0278,2475.4375,1302.0278,2471.4375" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1302.0278" y="2438.2388">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1302.0278" y="2453.3716">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="2530.8359" y2="2530.8359"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="2530.8359" y2="2543.8359"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="2543.8359" y2="2543.8359"/><polygon fill="#181818" points="1306.0278,2539.8359,1296.0278,2543.8359,1306.0278,2547.8359,1302.0278,2543.8359" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="1302.0278" y="2495.5044">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="1302.0278" y="2510.6372">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="1302.0278" y="2525.77">- Content-Type: application/json</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,2568.9688,683.0752,2572.9688,693.0752,2576.9688,689.0752,2572.9688" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1284.0278" y1="2572.9688" y2="2572.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="2567.9028">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,2598.1016,1283.0278,2602.1016,1273.0278,2606.1016,1277.0278,2602.1016" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1279.0278" y1="2602.1016" y2="2602.1016"/><ellipse cx="689.5752" cy="2592.6016" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="2597.0356">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1678.1943,2627.2344,1688.1943,2631.2344,1678.1943,2635.2344,1682.1943,2631.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1684.1943" y1="2631.2344" y2="2631.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1302.0278" y="2626.1685">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1306.0278,2792.5625,1296.0278,2796.5625,1306.0278,2800.5625,1302.0278,2796.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1300.0278" x2="1694.1943" y1="2796.5625" y2="2796.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1312.0278" y="2655.3013">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.0288" x="1312.0278" y="2670.4341">Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1312.0278" y="2685.5669">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1320.2925" y="2700.6997">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.9028" x="1320.2925" y="2715.8325">status: "AUTHORIZED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="1320.2925" y="2730.9653">capture.mode: "MANUAL",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1320.2925" y="2746.0981">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350.5049" x="1328.5571" y="2761.231">{type: "AUTHORIZATION", status: "AUTHORIZED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1320.2925" y="2776.3638">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1312.0278" y="2791.4966">}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="2825.6953" y2="2825.6953"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="2825.6953" y2="2838.6953"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="2838.6953" y2="2838.6953"/><polygon fill="#181818" points="1306.0278,2834.6953,1296.0278,2838.6953,1306.0278,2842.6953,1302.0278,2838.6953" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1302.0278" y="2820.6294">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="96.356,2878.9609,86.356,2882.9609,96.356,2886.9609,92.356,2882.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="1289.0278" y1="2882.9609" y2="2882.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="102.356" y="2862.7622">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340.5391" x="102.356" y="2877.895">{Status: "AUTHORIZED", Capture.Mode: "MANUAL"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="127.356" y1="2972.625" y2="2972.625"/><line style="stroke:#181818;stroke-width:2;" x1="127.356" x2="127.356" y1="2972.625" y2="2985.625"/><line style="stroke:#181818;stroke-width:2;" x1="86.356" x2="127.356" y1="2985.625" y2="2985.625"/><polygon fill="#181818" points="96.356,2981.625,86.356,2985.625,96.356,2989.625,92.356,2985.625" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="92.356" y="2907.0278">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.8857" x="92.356" y="2922.1606">- payment.Capture.Mode == "MANUAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.6523" x="92.356" y="2937.2935">- payment.Status == "AUTHORIZED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="92.356" y="2952.4263">- payment.Transactions.length == 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.1123" x="92.356" y="2967.5591">- payment.Transactions[0].Type == "AUTHORIZATION"</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1763.062" x="0" y="3014.1914"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="3014.1914" y2="3014.1914"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="3017.1914" y2="3017.1914"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="272.083" x="745.4895" y="3003.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="253.5571" x="751.4895" y="3019.6919">Phase 4: Manual Reversal Request</text><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="85.356" x2="132.356" y1="3068.0234" y2="3068.0234"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="3068.0234" y2="3081.0234"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="3081.0234" y2="3081.0234"/><polygon fill="#181818" points="101.356,3077.0234,91.356,3081.0234,101.356,3085.0234,97.356,3081.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.6733" x="97.356" y="3047.8247">Prepare Reversal:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.8877" x="97.356" y="3062.9575">Call Reversal(ctx, client, paymentID)</text></g><g class="message" data-participant-1="Test" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3111.1563,890.4297,3115.1563,880.4297,3119.1563,884.4297,3115.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="886.4297" y1="3115.1563" y2="3115.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.4883" x="97.356" y="3110.0903">Reversal(ctx, client, paymentID)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3140.2891,683.0752,3144.2891,693.0752,3148.2891,689.0752,3144.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3144.2891" y2="3144.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="3139.2231">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3169.4219,890.4297,3173.4219,880.4297,3177.4219,884.4297,3173.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3173.4219" y2="3173.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="3168.356">true</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3198.5547,683.0752,3202.5547,693.0752,3206.5547,689.0752,3202.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3202.5547" y2="3202.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.6914" x="699.0752" y="3197.4888">GetAudience()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3227.6875,890.4297,3231.6875,880.4297,3235.6875,884.4297,3231.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3231.6875" y2="3231.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.375" x="684.0752" y="3226.6216">audience URL</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3275.9531" y2="3275.9531"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3275.9531" y2="3288.9531"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3288.9531" y2="3288.9531"/><polygon fill="#181818" points="913.4297,3284.9531,903.4297,3288.9531,913.4297,3292.9531,909.4297,3288.9531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.0298" x="909.4297" y="3255.7544">Create HTTP POST Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358.5981" x="909.4297" y="3270.8872">POST {audience}/v1/payments/{paymentId}/reversals</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3333.2188" y2="3333.2188"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3333.2188" y2="3346.2188"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3346.2188" y2="3346.2188"/><polygon fill="#181818" points="913.4297,3342.2188,903.4297,3346.2188,913.4297,3350.2188,909.4297,3346.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.8833" x="909.4297" y="3313.02">Generate Idempotency-Key</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.3965" x="909.4297" y="3328.1528">(paymentID + timestamp.UnixNano())</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="944.4297" y1="3420.75" y2="3420.75"/><line style="stroke:#181818;stroke-width:2;" x1="944.4297" x2="944.4297" y1="3420.75" y2="3433.75"/><line style="stroke:#181818;stroke-width:2;" x1="903.4297" x2="944.4297" y1="3433.75" y2="3433.75"/><polygon fill="#181818" points="913.4297,3429.75,903.4297,3433.75,913.4297,3437.75,909.4297,3433.75" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.9668" x="909.4297" y="3370.2856">Set Headers:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4673" x="909.4297" y="3385.4185">- Authorization: Bearer {token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="909.4297" y="3400.5513">- Idempotency-Key: {key}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2793" x="909.4297" y="3415.6841">- Content-Type: application/json</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,3458.8828,683.0752,3462.8828,693.0752,3466.8828,689.0752,3462.8828" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="891.4297" y1="3462.8828" y2="3462.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="3457.8169">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="AuthProvider"><polygon fill="#181818" points="880.4297,3488.0156,890.4297,3492.0156,880.4297,3496.0156,884.4297,3492.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="886.4297" y1="3492.0156" y2="3492.0156"/><ellipse cx="689.5752" cy="3482.5156" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="3486.9497">http.Client</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1678.1943,3517.1484,1688.1943,3521.1484,1678.1943,3525.1484,1682.1943,3521.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="902.4297" x2="1684.1943" y1="3521.1484" y2="3521.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.604" x="909.4297" y="3516.0825">POST /v1/payments/{paymentId}/reversals</text></g><path d="M25,3536.1484 L84.4429,3536.1484 L84.4429,3543.2813 L74.4429,3553.2813 L20,3553.2813 L20,3541.1484 A5,5 0 0 1 25,3536.1484" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="486.7266" rx="5" ry="5" style="stroke:#000000;stroke-width:1.5;" width="1723.062" x="20" y="3536.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="3549.2153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105.4238" x="99.4429" y="3548.3589">[Reversal Failed]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="913.4297,3570.4141,903.4297,3574.4141,913.4297,3578.4141,909.4297,3574.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="907.4297" x2="1689.1943" y1="3574.4141" y2="3574.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.3535" x="919.4297" y="3569.3481">Error Response</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,3599.5469,91.356,3603.5469,101.356,3607.5469,97.356,3603.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="896.4297" y1="3603.5469" y2="3603.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.2852" x="107.356" y="3598.481">Return Error</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="90.356" x2="132.356" y1="3632.6797" y2="3632.6797"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="132.356" x2="132.356" y1="3632.6797" y2="3645.6797"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="91.356" x2="132.356" y1="3645.6797" y2="3645.6797"/><polygon fill="#181818" points="101.356,3641.6797,91.356,3645.6797,101.356,3649.6797,97.356,3645.6797" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.1797" x="97.356" y="3627.6138">t.Fatal(err)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="20" x2="1743.062" y1="3654.6797" y2="3654.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116.9609" x="25" y="3664.8901">[Reversal Success]</text><g class="message" data-participant-1="AkuaAPI" data-participant-2="AuthProvider"><polygon fill="#181818" points="908.4297,3836.9453,898.4297,3840.9453,908.4297,3844.9453,904.4297,3840.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="902.4297" x2="1694.1943" y1="3840.9453" y2="3840.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.0259" x="914.4297" y="3684.5513">200 OK / 201 Created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.5698" x="914.4297" y="3699.6841">Reversal Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="914.4297" y="3714.8169">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.1914" x="922.6943" y="3729.9497">payment_id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.2192" x="922.6943" y="3745.0825">transaction: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.418" x="930.959" y="3760.2153">type: "REVERSAL",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4116" x="930.959" y="3775.3481">status: "REVERSED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.3081" x="930.959" y="3790.481">id: transaction_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.8306" x="930.959" y="3805.6138">amount: amount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="922.6943" y="3820.7466">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="914.4297" y="3835.8794">}</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="AuthProvider"><line style="stroke:#181818;stroke-width:2;" x1="897.4297" x2="939.4297" y1="3870.0781" y2="3870.0781"/><line style="stroke:#181818;stroke-width:2;" x1="939.4297" x2="939.4297" y1="3870.0781" y2="3883.0781"/><line style="stroke:#181818;stroke-width:2;" x1="898.4297" x2="939.4297" y1="3883.0781" y2="3883.0781"/><polygon fill="#181818" points="908.4297,3879.0781,898.4297,3883.0781,908.4297,3887.0781,904.4297,3883.0781" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="904.4297" y="3865.0122">json.Unmarshal(response)</text></g><g class="message" data-participant-1="AuthProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,3923.3438,91.356,3927.3438,101.356,3931.3438,97.356,3927.3438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="896.4297" y1="3927.3438" y2="3927.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.021" x="107.356" y="3907.145">Return *ReversalResponse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306.5601" x="107.356" y="3922.2778">{PaymentId, Transaction.Status: "REVERSED"}</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4001.875" y2="4001.875"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4001.875" y2="4014.875"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4014.875" y2="4014.875"/><polygon fill="#181818" points="101.356,4010.875,91.356,4014.875,101.356,4018.875,97.356,4014.875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.5967" x="97.356" y="3951.4106">Log reversal response details:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.0767" x="97.356" y="3966.5435">- Reversal ID (PaymentId)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.7983" x="97.356" y="3981.6763">- Reversal Status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.4595" x="97.356" y="3996.8091">- Reversal Amount</text></g><rect fill="#EEEEEE" height="3" rx="5" ry="5" style="stroke:#EEEEEE;stroke-width:1;" width="1763.062" x="0" y="4050.4414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="4050.4414" y2="4050.4414"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1763.062" y1="4053.4414" y2="4053.4414"/><rect fill="#EEEEEE" height="23.1328" rx="5" ry="5" style="stroke:#000000;stroke-width:2;" width="404.7808" x="679.1406" y="4039.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="386.2549" x="685.1406" y="4055.9419">Phase 5: Verify Final Payment State (After Reversal)</text><g class="message" data-participant-1="Test" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,4090.1406,1283.0278,4094.1406,1273.0278,4098.1406,1277.0278,4094.1406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="1279.0278" y1="4094.1406" y2="4094.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4341" x="97.356" y="4089.0747">GetPaymentById(ctx, client, paymentID)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,4119.2734,683.0752,4123.2734,693.0752,4127.2734,689.0752,4123.2734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1284.0278" y1="4123.2734" y2="4123.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.6489" x="699.0752" y="4118.2075">JwtIsValid()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,4148.4063,1283.0278,4152.4063,1273.0278,4156.4063,1277.0278,4152.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1279.0278" y1="4152.4063" y2="4152.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26.6792" x="684.0752" y="4147.3403">true</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="4196.6719" y2="4196.6719"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="4196.6719" y2="4209.6719"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="4209.6719" y2="4209.6719"/><polygon fill="#181818" points="1306.0278,4205.6719,1296.0278,4209.6719,1306.0278,4213.6719,1302.0278,4209.6719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.9937" x="1302.0278" y="4176.4731">Create HTTP GET Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.6792" x="1302.0278" y="4191.606">GET {audience}/v1/payments/{paymentId}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="4238.8047" y2="4238.8047"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="4238.8047" y2="4251.8047"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="4251.8047" y2="4251.8047"/><polygon fill="#181818" points="1306.0278,4247.8047,1296.0278,4251.8047,1306.0278,4255.8047,1302.0278,4251.8047" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.5869" x="1302.0278" y="4233.7388">Set Headers</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Client"><polygon fill="#181818" points="693.0752,4276.9375,683.0752,4280.9375,693.0752,4284.9375,689.0752,4280.9375" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="687.0752" x2="1284.0278" y1="4280.9375" y2="4280.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.1694" x="699.0752" y="4275.8716">GetHttpClient()</text></g><g class="message" data-participant-1="Client" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1273.0278,4306.0703,1283.0278,4310.0703,1273.0278,4314.0703,1277.0278,4310.0703" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="677.0752" x2="1279.0278" y1="4310.0703" y2="4310.0703"/><ellipse cx="689.5752" cy="4300.5703" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.4531" x="696.0752" y="4305.0044">http.Client</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="AkuaAPI"><polygon fill="#181818" points="1678.1943,4335.2031,1688.1943,4339.2031,1678.1943,4343.2031,1682.1943,4339.2031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1684.1943" y1="4339.2031" y2="4339.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.6851" x="1302.0278" y="4334.1372">GET /v1/payments/{paymentId}</text></g><g class="message" data-participant-1="AkuaAPI" data-participant-2="PaymentsProvider"><polygon fill="#181818" points="1306.0278,4515.6641,1296.0278,4519.6641,1306.0278,4523.6641,1302.0278,4519.6641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="1300.0278" x2="1694.1943" y1="4519.6641" y2="4519.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="1312.0278" y="4363.27">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.0679" x="1312.0278" y="4378.4028">Final Payment Response:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1312.0278" y="4393.5356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.7817" x="1320.2925" y="4408.6685">id: payment_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.2446" x="1320.2925" y="4423.8013">status: "CANCELLED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1328" x="1320.2925" y="4438.9341">capture.mode: "MANUAL",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.793" x="1320.2925" y="4454.0669">transactions: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354.6372" x="1328.5571" y="4469.1997">{type: "AUTHORIZATION", status: "AUTHORIZED", ...},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293.0332" x="1328.5571" y="4484.3325">{type: "REVERSAL", status: "REVERSED", ...}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0718" x="1320.2925" y="4499.4653">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8.271" x="1312.0278" y="4514.5981">}</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="PaymentsProvider"><line style="stroke:#181818;stroke-width:2;" x1="1295.0278" x2="1337.0278" y1="4548.7969" y2="4548.7969"/><line style="stroke:#181818;stroke-width:2;" x1="1337.0278" x2="1337.0278" y1="4548.7969" y2="4561.7969"/><line style="stroke:#181818;stroke-width:2;" x1="1296.0278" x2="1337.0278" y1="4561.7969" y2="4561.7969"/><polygon fill="#181818" points="1306.0278,4557.7969,1296.0278,4561.7969,1306.0278,4565.7969,1302.0278,4561.7969" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.5044" x="1302.0278" y="4543.731">json.Unmarshal(response)</text></g><g class="message" data-participant-1="PaymentsProvider" data-participant-2="Test"><polygon fill="#181818" points="101.356,4632.3281,91.356,4636.3281,101.356,4640.3281,97.356,4636.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2.0,2.0;" x1="95.356" x2="1289.0278" y1="4636.3281" y2="4636.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.0806" x="107.356" y="4585.8638">Return *Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.9761" x="107.356" y="4600.9966">with both transactions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195.146" x="107.356" y="4616.1294">- AUTHORIZATION transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154.1655" x="107.356" y="4631.2622">- REVERSAL transaction</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4725.9922" y2="4725.9922"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4725.9922" y2="4738.9922"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4738.9922" y2="4738.9922"/><polygon fill="#181818" points="101.356,4734.9922,91.356,4738.9922,101.356,4742.9922,97.356,4738.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.0796" x="97.356" y="4660.395">Verify Final State:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8086" x="97.356" y="4675.5278">- payment.Transactions.length == 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.1123" x="97.356" y="4690.6606">- payment.Transactions[0].Type == "AUTHORIZATION"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318.1318" x="97.356" y="4705.7935">- payment.Transactions[1].Type == "REVERSAL"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231.9941" x="97.356" y="4720.9263">- payment.Status == "CANCELLED"</text></g><g class="message" data-participant-1="Test" data-participant-2="Test"><line style="stroke:#181818;stroke-width:2;" x1="90.356" x2="132.356" y1="4798.3906" y2="4798.3906"/><line style="stroke:#181818;stroke-width:2;" x1="132.356" x2="132.356" y1="4798.3906" y2="4811.3906"/><line style="stroke:#181818;stroke-width:2;" x1="91.356" x2="132.356" y1="4811.3906" y2="4811.3906"/><polygon fill="#181818" points="101.356,4807.3906,91.356,4811.3906,101.356,4815.3906,97.356,4811.3906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45.2588" x="97.356" y="4763.0591">Assert:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.4404" x="97.356" y="4778.1919">- lastPaymentState.Status == "CANCELLED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296.0928" x="97.356" y="4793.3247">(expected payment status to be CANCELLED)</text></g><path d="M95,4829.3906 L95,4965.3906 A5,5 0 0 0 100,4970.3906 L612,4970.3906 A5,5 0 0 0 617,4965.3906 L617,4834.3906 L607,4824.3906 L100,4824.3906 A5,5 0 0 0 95,4829.3906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M607,4824.3906 L607,4831.8906 A2.5,2.5 0 0 0 609.5,4834.3906 L617,4834.3906 L607,4824.3906" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="267.1221" x="101" y="4841.4575">Key Points of Manual Reversal Flow:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290.1133" x="101" y="4856.5903">1. Authorization with MANUAL capture mode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393.3516" x="101" y="4871.7231">2. Payment stays in "AUTHORIZED" state after authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287.1362" x="101" y="4886.856">3. Reversal cancels the authorized payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.2456" x="101" y="4901.9888">4. Payment has 2 transactions after reversal:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344.2334" x="113.397" y="4917.1216">- AUTHORIZATION transaction (status: AUTHORIZED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.7617" x="113.397" y="4932.2544">- REVERSAL transaction (status: REVERSED)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261.8662" x="101" y="4947.3872">5. Final payment status is "CANCELLED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="501.7061" x="101" y="4962.52">6. Reversal is used to cancel an authorized\n   but not yet captured payment</text><!--SRC=[vLbRRzis57xNhpZpNkpCaPEqtOE1370TftMR6sAd0zeK1ICnZHQPyYJQgHlul- -G8YLI5rjfjw50KpIso4FoNB_lKE413oaC5lmkYeElX0SHW-CmUe1TE2LiGKAuf4iQ9oHqdEG-O7CIanaazEy5PHuTn77qCBqBl7j6amGE394uMZ3VYs96OzZVCoPkY7V_MSuEep2AuTVZWVZdECJZ-DYQqeJ3yO9vGfSMa0J4Y8EBUU05Sy8ujCOiu049Ww_qWgncb76XifGLC-B1bYVt2-8Emm0bfLJwrPQnV70HHyl0fx6K5ZDwm5wZJayiyU9WuHXK1GONutHdVC3lZdDu21Tt9A6mtuVCk3GQXuUETCdk7vbnXepfWBR7ltI46uCbuJHtXQE_rUqnOijt90x8JKYJTkUQdKJ41vUo9Tm68RMMfvxhmnbzIB-sZHELMzCFKrfkYFi5SSI4jh3Kn_MlsIuCtbuDFWrFngEpwQVnKN5aCXfUZgRPwE3g28U7espW_FBLu6pyVZ0TdvzPoyzFJqUNmn6ELQZq3YttXT8a38LgGgK4I4mnkNCJB8VjgD4sfYd5p8yxZa-BnZiavEex36EgAegW7tq7y2Tt9kuj0jl72kEBcC58R2bbZ5sp88hnD0-oTTmz9fo4RTIbuz0meTQvr8V9mlEmBcyNORWg76x7viq3dqRtb64mXLZH9Z4cVvNTU17JkN3QkIWIY0Kke8utaRygB52fZYlE9rFeHGJbUrmSQX-fIo8xK_ZppPzJa0gYhz8J38-A7xLAEaUh9ls92v9vn1AQYLQ6jXI2GXWCHnHcJ7sRndTJZBV5MSpBMES-KM7Uw8o3lNsT5jViaSW5dwJxk-2wxhg9QUNeJn2niOACtJQxETSvnAmpubVjQihyF0-gGGnng1AuLIRNBYg2T4c-6Bss9_Ng0Z7Oe0lpmZvTO47OgQrYOL4EzWVz0lFgx3OmFrL2bvaMfqeoXSyPiYaAFGuNSOoqlEf3wsforEeAa5lGFlBltbe8ZXcNOMiHyzIMc3gbiNU713Ns-v1QwhwYF1yLjB0BGp97Pr3tDF9nszRfuEngSD9Ajqvul9Z9xOSazj5wZYMQvEGWMJmpo-JKt0jKK5WNjAiLd1WCOr6nOpwPQObmDauam6zWfv8Ig3_jtHAihJfOpzDtp9PYUnbdMuiiPBBSvGSkawlE8ZwXl9WRbacDK3vNursD4aNJ_aeYvfuYmTtXHighHxXhftAjTYCcm63X1wBHsq0CjVuaQYrSNPuuzKNUGFqKkE3rT7gHqeVA_cicdnxrIUlUShzdvNRIOFTN57jKMQK-dSqZBYfezorTNRCsaPNbBaKPmM_0WncUIcPpzue5Nyu8YzgTJeCJCEhmcYBWnQhVCLNimqkAfHt3emJGj51jJR2qx-bApWmZMSExqzKSAv3Cvs7WoMrw8iRr3ZLY-fhpUTQxFJcgEtUut3Kadn9LkmSe1GkPIINdIsmWu270bi9Ja3D3o3bC0MVTe6Cet6ZgkmNREhjdWFRplRtU2_nFkUTsylNL5R-DvujykWa46hS1jg6RMW7RKgiXAB9GQZw6Gz7Rfy3l8ZuIbX0lpTb7h0E-I9041bVJr-UNu_SZGJYYbMZKIzJuiXAuhjWiWwvKiwQXsB4CGtiKxO-FkZ3DpN4d5SQi6yUf432jmo19Q9moj9NcyCkXQ19Auswcd9B8UY2xQtY6bnSQ1xShVTC4eJucwqjwAzenVM7lc6r4iT-HIA06NwwGtotYdMjD3FeiNMkTuiYtK71PBq73LGIywJIRgPvqdCLI3Oyjxs8orAkHGL3YmUOdtJ7sT76D_NN3KvxC8rlOOfjFBQPuabSjbcZerOmTXCzgFLL25CV4kB8c1tjxSFuMEmLLAnhSq86FrmmWm8RNG3anL0bjOiBaehpzbLC6EEBA3s88C1BIxza-yXK5ecGzTefr7w_Psgc0peP9KWkPvUKbk5GYw9f9fOhL_R-bRHacQb5HkTqrTqNCikuLMYRLHyuQ6faI1fudRaZPPsmUK7o_JkR3taTNr8MrPneX0soVzullGRTVqhGa6ZaKRvVqytQCtNH7QhxBVtr9gYhePdU8niTiG-L_yRvGXJAzM3axSRxvxf15flRYyADS6focbuN6uTi6_zil1bkYKWP7qVHd9Mhq-qrxVUSfZNrDO_jTj_fCURE7tzI_2rw3djt86o2LzV22KtA6Ax6TtTQdnALuwtBqRdGvqHHd46CweMan9L5Z7xqrNiNKgwdqKuoj1RjjyA7pdPU2BHS2xI33Fxhjzclk19cnwwr1TigtW9FeC-Yy1QsgVZic2pkB6K95ErEcOqsbobX3wLk_mjtWHNOtE0uO2XLk28DRJkEVwOBm0tJgFrMNRMVTKthjuU1iE3ev-VzQxQwzCCUwAfZxePfp-Lxi9i9VbYjaas2QRqvBw50cckDFQTqjP968qc_GW1zyGmDUksJVM995hEQUa6VKXZj8I1ADSjAYwWsmdQDVvjGJVrHL9wai0Hx13LQS5kqu3iCU3EBWyns7w3PjwKMYxUnWKmONKO0U5XF5QuNyqzJEZfJTTmllzMJ8qoBGfG6YDAJqWPjL72grIY1WLhvBLIaG2VxMAoUv_9cRA-4H1ByGhRgZcMHkinH_df-6b0C7LXAgGpJXzVMhiGsP2MrTRxdAdNnTLTBcItI5fWjUk2ev2p4A4YiRXEZlXj4ulKZGIWnbQZyGPbWlSU9cmG432oi4TXM0t2t8mMAI_WC0]--></g></svg>